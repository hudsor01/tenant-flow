(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6769],{217:(e,t,s)=>{"use strict";s.d(t,{ND:()=>c});var i=s(35415),r=s(95048);let n={NEXT_PUBLIC_SUPABASE_URL:"https://bshjmbshupiibfiewpxb.supabase.co",NEXT_PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzaGptYnNodXBpaWJmaWV3cHhiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0MDc1MDYsImV4cCI6MjA2Mzk4MzUwNn0.K9cR4SN_MtutRWPJsymtAtlHpEJFyfnQgtu8BjQRqko"},a=n.NEXT_PUBLIC_SUPABASE_URL,o=n.NEXT_PUBLIC_SUPABASE_ANON_KEY,l=null,u=null,c={get client(){if(l)return l;if(!a||!o)throw Error("Supabase environment variables are not set.");return l=(0,r.UU)(a,o)}}.client,d={get client(){if(u)return u;if(!a||!o)throw Error("Supabase environment variables are not set for anon client.");return u=(0,r.UU)(a,o,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1}})}}.client;class h{get client(){if(!c)throw Error("Supabase client is not initialized. Please check that NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY environment variables are set.");return c}get anonClient(){if(!d)throw Error("Supabase anonymous client is not initialized. Please check that NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY environment variables are set.");return d}get auth(){return this.client.auth}from(e){return this.client.from(e)}get storage(){return this.client.storage}channel(e){return this.client.channel(e)}get anon(){return{from:e=>this.anonClient.from(e),auth:this.anonClient.auth,storage:this.anonClient.storage}}get isAvailable(){return null!==c}getRawClient(){return this.client}getRawAnonClient(){return this.anonClient}}new h,new i.E1({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:(e,t)=>{var s,i;return!((null==t||null==(s=t.message)?void 0:s.includes("40"))||(null==t||null==(i=t.message)?void 0:i.includes("Unauthorized")))&&e<3},retryDelay:e=>Math.min(1e3*2**e,3e4)},mutations:{retry:!1}}})},9176:(e,t,s)=>{"use strict";let i;s.d(t,{SX:()=>o});var r=s(35415),n=s(51874);function a(e){let t=e instanceof Error?e.message:"An unexpected error occurred";"Network error"===t||t.includes("401")||n.oR.error(t)}function o(){return i||(i=new r.E1({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:(e,t)=>!(e>=3||t instanceof Error&&t.message.includes("40")&&!t.message.includes("408")&&!t.message.includes("429")),retryDelay:e=>Math.min(1e3*2**e,3e4),refetchOnWindowFocus:!0,refetchOnReconnect:"always"},mutations:{onError:a,retry:1,retryDelay:1e3}}})),i}},22364:(e,t,s)=>{"use strict";s.d(t,{QueryProvider:()=>o});var i=s(54568),r=s(35415),n=s(7620),a=s(9176);function o(e){let{children:t}=e,[s]=(0,n.useState)(()=>(0,a.SX)());return(0,i.jsx)(r.Ht,{client:s,children:t})}},30263:(e,t,s)=>{"use strict";s.d(t,{Ny:()=>i.Nyo,motion:()=>i.PY1});var i=s(21229)},45212:(e,t,s)=>{Promise.resolve().then(s.bind(s,86962))},53039:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=53039,e.exports=t},85745:()=>{},86962:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w});var i=s(54568),r=s(7620),n=s(62942),a=s(30263),o=s(85191),l=s(49369),u=s(31356),c=s(217),d=s(51874),h=s(35415);let m={auth:{signInSuccess:"Successfully signed in!",signInError:"Failed to sign in. Please check your credentials.",signOutSuccess:"Successfully signed out!",signOutError:"Failed to sign out. Please try again.",sessionExpired:"Your session has expired. Please sign in again.",emailConfirmed:"Email confirmed successfully!",passwordUpdated:"Password updated successfully!",profileUpdated:"Profile updated successfully!"}};var g=s(85745);function f(){let e=(0,n.useRouter)(),t=(0,h.jE)(),[s,f]=(0,r.useState)({state:"loading",message:"Processing authentication..."});return(0,r.useEffect)(()=>{let i=!0;(async()=>{g.debugSupabaseAuth.log("Starting authentication processing");try{if(!c.ND)throw Error("Authentication service not available");let s=new URLSearchParams(window.location.hash.substring(1)),r=s.get("access_token"),n=s.get("refresh_token"),a=s.get("type"),o=s.get("error"),l=s.get("error_code"),u=s.get("error_description");if(o||l){let{data:{session:s}}=await c.ND.auth.getSession();if(null==s?void 0:s.user){await t.invalidateQueries({queryKey:["auth"]}),f({state:"success",message:"Already authenticated!",details:"Redirecting to dashboard..."}),d.oR.success("Welcome back! You are already signed in."),window.history.replaceState(null,"",window.location.pathname+window.location.search),setTimeout(()=>{e.push("/dashboard")},500);return}if("otp_expired"===l){f({state:"error",message:"Email link expired",details:"Please request a new confirmation email"}),d.oR.error("Email confirmation link has expired. Please sign up again."),setTimeout(()=>{e.push("/auth/login")},3e3);return}throw Error(u||o||"Authentication failed")}if(r&&n){f({state:"loading",message:"signup"===a?"Confirming your email...":"Completing sign in...",details:"Setting up your session"});let s=performance.now();try{let o=c.ND.auth.setSession({access_token:r,refresh_token:n}),l=new Promise((e,t)=>setTimeout(()=>t(Error("Session setup timeout")),1e4)),{data:u,error:h}=await Promise.race([o,l]),g=performance.now()-s;if(g>5e3&&console.warn("[Auth] Session setup is taking unusually long!",g),h)throw console.error("[Auth] SetSession error:",h),h;if((null==u?void 0:u.session)&&i){let{data:{session:s}}=await c.ND.auth.getSession();console.log("[Auth] Verified session stored:",!!s),await t.invalidateQueries({queryKey:["auth"]}),f({state:"success",message:"signup"===a?"Email confirmed!":"Authentication successful!",details:"Welcome to TenantFlow!"}),d.oR.success("signup"===a?m.auth.emailConfirmed:m.auth.signInSuccess),window.history.replaceState(null,"",window.location.pathname+window.location.search),setTimeout(()=>{e.push("/dashboard")},500);return}console.warn("[Auth] No session returned from setSession")}catch(t){if(console.error("[Auth] Error setting session from tokens:",t),r&&n&&"signup"===a){f({state:"success",message:"Email confirmed!",details:"Redirecting to dashboard..."}),d.oR.success("Email confirmed! Welcome to TenantFlow!"),window.history.replaceState(null,"",window.location.pathname+window.location.search),setTimeout(()=>{e.push("/dashboard")},1e3);return}throw t}}let h=new URLSearchParams(window.location.search).get("code");if(h){f({state:"loading",message:"Completing sign in...",details:"Exchanging authentication code"});try{let{data:s,error:r}=await c.ND.auth.exchangeCodeForSession(h);if(r)throw r;if(s.session&&i){await t.invalidateQueries({queryKey:["auth"]}),f({state:"success",message:"Authentication successful!",details:"Welcome back!"}),d.oR.success(m.auth.signInSuccess),e.push("/dashboard");return}}catch(t){if(t instanceof Error&&t.message.includes("code verifier")){console.error("[Auth] PKCE error - user likely clicked email link in different browser"),f({state:"error",message:"Authentication error",details:"Please sign in again or use the same browser you signed up with"}),d.oR.error("Please use the same browser you signed up with"),setTimeout(()=>void e.push("/auth/login"),3e3);return}throw t}}let g=new URLSearchParams(window.location.search),p=g.has("type")&&"signup"===g.get("type"),{data:{session:w},error:y}=await c.ND.auth.getSession();if(y)throw y;if(!i)return;(null==w?void 0:w.user)?(await t.invalidateQueries({queryKey:["auth"]}),f({state:"success",message:"Authentication successful!",details:"Welcome back!"}),d.oR.success(m.auth.signInSuccess),e.push("/dashboard")):p?(f({state:"success",message:"Email confirmed successfully!",details:"Please sign in with your credentials"}),d.oR.success("Email confirmed! Please sign in to continue."),setTimeout(()=>{e.push("/auth/login?emailConfirmed=true")},2e3)):(f({state:"error",message:"Authentication required",details:"Please sign in to continue"}),setTimeout(()=>{e.push("/auth/login")},2e3))}catch(t){if(!i)return;console.error("Auth processing error:",t),f({state:"error",message:"Authentication error",details:t instanceof Error?t.message:"Please try signing in again"}),d.oR.error("Authentication failed"),setTimeout(()=>{e.push("/auth/login")},2e3)}})();let r=setTimeout(()=>{i&&"loading"===s.state&&(f({state:"error",message:"Authentication timeout",details:"Taking too long, please try again"}),d.oR.error("Authentication timeout"),e.push("/auth/login"))},3e4);return()=>{i=!1,clearTimeout(r)}},[t,s.state,e]),(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 px-4",children:(0,i.jsxs)(a.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"w-full max-w-md rounded-2xl border-2 p-8 text-center shadow-xl backdrop-blur-sm ".concat((()=>{switch(s.state){case"loading":return"border-primary/20 bg-primary/5";case"success":return"border-green-200 bg-green-50";case"error":return"border-red-200 bg-red-50";default:return"border-gray-200 bg-gray-50"}})()),children:[(0,i.jsx)(a.motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1,type:"spring",stiffness:200},className:"mb-6 flex justify-center",children:(()=>{switch(s.state){case"loading":default:return(0,i.jsx)(l.A,{className:"h-12 w-12 animate-spin text-primary"});case"success":return(0,i.jsx)(o.A,{className:"h-12 w-12 text-green-500"});case"error":return(0,i.jsx)(u.A,{className:"h-12 w-12 text-red-500"})}})()}),(0,i.jsxs)(a.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[(0,i.jsx)("h1",{className:"mb-2 text-2xl font-bold text-foreground",children:s.message}),s.details&&(0,i.jsx)("p",{className:"text-muted-foreground",children:s.details}),"loading"===s.state&&(0,i.jsx)(a.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"mt-4",children:(0,i.jsx)("div",{className:"h-1 w-full bg-gray-200 rounded-full overflow-hidden",children:(0,i.jsx)(a.motion.div,{className:"h-full bg-primary rounded-full",initial:{width:0},animate:{width:"100%"},transition:{duration:2,ease:"easeInOut"}})})}),"error"===s.state&&(0,i.jsx)(a.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"mt-4",children:(0,i.jsx)("button",{onClick:()=>void e.push("/auth/login"),className:"text-primary hover:text-primary/80 font-semibold underline transition-colors",children:"Return to login"})})]})]})})}var p=s(22364);function w(){return(0,i.jsx)(p.QueryProvider,{children:(0,i.jsx)(f,{})})}}},e=>{e.O(0,[2486,7128,3164,2229,1665,8961,9897,7760,7031,80,3755,1543,2484,6007,7088,8906,3243,96,8591,1810,6171,3083,8372,7358],()=>e(e.s=45212)),_N_E=e.O()}]);