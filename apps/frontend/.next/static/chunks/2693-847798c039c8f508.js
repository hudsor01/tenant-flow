(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2693],{1525:(e,s,t)=>{"use strict";t.d(s,{Bh:()=>o,Ht:()=>i,ND:()=>n});var a=t(95048),r=t(4965);let n=(0,a.UU)(r.$.supabase.url,r.$.supabase.anonKey,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"}});async function i(){let{data:{session:e},error:s}=await n.auth.getSession();return{session:e,error:s}}function o(e){return n.auth.onAuthStateChange(e)}n.auth},4965:(e,s,t)=>{"use strict";t.d(s,{$:()=>r});var a=t(40459);let r={api:{baseURL:"https://api.tenantflow.app/api/v1",timeout:3e4},supabase:{url:"https://bshjmbshupiibfiewpxb.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJzaGptYnNodXBpaWJmaWV3cHhiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg0MDc1MDYsImV4cCI6MjA2Mzk4MzUwNn0.K9cR4SN_MtutRWPJsymtAtlHpEJFyfnQgtu8BjQRqko"},stripe:{publishableKey:"pk_live_51Rd0qyP3WCR53SdoTX2cuAbujIY3WaQSSpu1esdawYD3m96SLWyRRavIZpJkh9BDNdIr8DwYluWVoMQCMqLRUf6Y00jWRkMx8j"},analytics:{posthogKey:"phc_rSyH7L2ImIDIi4evbhKV2sozqmf5PWIZvGzFfrfuVHf",posthogHost:"https://us.i.posthog.com"},app:{env:"production",version:"1.0.0",name:"TenantFlow"},features:{analytics:!0,errorReporting:!0}};for(let e of["NEXT_PUBLIC_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_ANON_KEY","NEXT_PUBLIC_API_URL","NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY","NEXT_PUBLIC_POSTHOG_KEY","NEXT_PUBLIC_POSTHOG_HOST"])a.env[e]||console.warn("Missing required environment variable: ".concat(e))},18991:(e,s,t)=>{"use strict";t.d(s,{Se:()=>n,p9:()=>r,yN:()=>l});var a=t(57393);let r=(0,a.eU)(null);(0,a.eU)(e=>null!==e(r));let n=(0,a.eU)(!0),i=(0,a.eU)(null),o=(0,a.eU)(Date.now());(0,a.eU)(e=>{let s=e(r);return{id:(null==s?void 0:s.organizationId)||null,name:(null==s?void 0:s.organizationId)||null}});let l=(0,a.eU)(null);(0,a.eU)(e=>{let s=e(r),t=e(o),a=e(i),n=Date.now();return!!s&&(!a||!(n>a))&&!(n-t>18e5)}),(0,a.eU)(e=>{var s;return(null==(s=e(r))?void 0:s.role)||null}),(0,a.eU)(e=>{var s;return!!(null==(s=e(r))?void 0:s.stripeCustomerId)}),(0,a.eU)(e=>{let s=e(r);if(!s)return[];switch(s.role){case"OWNER":return["read","write","delete","admin"];case"MANAGER":return["read","write","delete"];default:return["read"]}}),(0,a.eU)(e=>{let s=e(r);return s&&s.stripeCustomerId?"active":"inactive"}),(0,a.eU)(null,(e,s,t)=>{s(r,t),s(o,Date.now()),s(l,null),s(n,!1)}),(0,a.eU)(null,(e,s,t)=>{let a=e(r);a&&(s(r,{...a,...t}),s(o,Date.now()))}),(0,a.eU)(null,(e,s)=>{s(r,null),s(i,null),s(l,null),s(n,!1)}),(0,a.eU)(null,(e,s)=>{s(o,Date.now())})},39879:(e,s,t)=>{"use strict";t.d(s,{u:()=>o});var a=t(48683),r=t(4965),n=t(1525);class i{setupInterceptors(){this.client.interceptors.request.use(async e=>{try{let{session:s}=await (0,n.Ht)();(null==s?void 0:s.access_token)&&(e.headers.Authorization="Bearer ".concat(s.access_token))}catch(e){console.warn("[API] Failed to add authentication:",e)}return e},e=>e instanceof Error?Promise.reject(e):Promise.reject(Error("string"==typeof e?e:JSON.stringify(e)))),this.client.interceptors.response.use(e=>e,async e=>{var s;return(null==(s=e.response)?void 0:s.status)===401&&(console.warn("[API] Authentication error - redirecting to login"),window.location.href="/login"),Promise.reject(e)})}async makeRequest(e,s,t,a){var r,n;try{let n=new AbortController,i=await this.client.request({method:e,url:s,data:t,...a,signal:(null==a?void 0:a.signal)||n.signal});return{data:i.data,success:i.status>=200&&i.status<300,message:null==(r=i.data)?void 0:r.message,timestamp:new Date().toISOString()}}catch(s){let e=null==(n=s.response)?void 0:n.data;throw{message:(null==e?void 0:e.message)||s.message||"Request failed",code:(null==e?void 0:e.code)||s.code,details:(null==e?void 0:e.details)||e,timestamp:new Date().toISOString()}}}async get(e,s){return this.makeRequest("GET",e,void 0,s)}async post(e,s,t){return this.makeRequest("POST",e,s,t)}async put(e,s,t){return this.makeRequest("PUT",e,s,t)}async patch(e,s,t){return this.makeRequest("PATCH",e,s,t)}async delete(e,s){return this.makeRequest("DELETE",e,void 0,s)}async healthCheck(){return this.get("/health")}createCancellableRequest(){let e=new AbortController;return{signal:e.signal,cancel:()=>e.abort()}}constructor(){this.client=a.Ay.create({baseURL:r.$.api.baseURL,timeout:r.$.api.timeout||3e4,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0,validateStatus:e=>e<500}),this.setupInterceptors()}}let o=new i},53039:e=>{function s(e){var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}s.keys=()=>[],s.resolve=s,s.id=53039,e.exports=s},98071:(e,s,t)=>{"use strict";t.d(s,{A:()=>c,y:()=>d});var a=t(7620),r=t(57393),n=t(51874),i=t(1525),o=t(39879);class l{static async login(e){let{data:s,error:t}=await i.ND.auth.signInWithPassword({email:e.email,password:e.password});if(t)throw{message:t.message,code:t.message};if(!s.session||!s.user)throw{message:"Login failed - no session created"};try{let e=await this.syncWithBackend();return{access_token:s.session.access_token,refresh_token:s.session.refresh_token,expires_in:s.session.expires_in||3600,user:e}}catch(e){return console.warn("Backend sync failed during login:",e),{access_token:s.session.access_token,refresh_token:s.session.refresh_token,expires_in:s.session.expires_in||3600,user:this.mapSupabaseUser(s.user)}}}static async signup(e){let{data:s,error:t}=await i.ND.auth.signUp({email:e.email,password:e.password,options:{data:{name:e.name,full_name:e.name}}});if(t)throw{message:t.message,code:t.message};if(!s.user)throw{message:"Signup failed - user not created"};return{message:"Account created successfully. Please check your email to verify your account."}}static async logout(){let{error:e}=await i.ND.auth.signOut();e&&console.warn("Logout error:",e)}static async getCurrentSession(){let{data:{session:e}}=await i.ND.auth.getSession();if(!e)return null;try{let s=await this.syncWithBackend();return{access_token:e.access_token,refresh_token:e.refresh_token,expires_in:e.expires_in||3600,user:s}}catch(e){return console.warn("Failed to sync with backend:",e),null}}static async refreshSession(){let{data:e,error:s}=await i.ND.auth.refreshSession();if(s||!e.session)return null;try{let s=await this.syncWithBackend();return{access_token:e.session.access_token,refresh_token:e.session.refresh_token,expires_in:e.session.expires_in||3600,user:s}}catch(e){return console.warn("Failed to sync with backend during refresh:",e),null}}static async syncWithBackend(){try{let e=await o.u.get("/auth/me");if(e.data&&"object"==typeof e.data&&"user"in e.data&&e.data.user)return e.data.user;return e.data}catch(e){throw console.error("Backend sync failed:",e),e}}static mapSupabaseUser(e){var s,t,a;return{id:e.id,email:e.email,name:(null==(s=e.user_metadata)?void 0:s.name)||(null==(t=e.user_metadata)?void 0:t.full_name),avatarUrl:null==(a=e.user_metadata)?void 0:a.avatar_url,role:"OWNER",emailVerified:!!e.email_confirmed_at,createdAt:e.created_at,updatedAt:e.updated_at,supabaseId:e.id,phone:null,bio:null,stripeCustomerId:null,organizationId:null}}static async resetPassword(e){let{error:s}=await i.ND.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(s)throw{message:s.message,code:s.message};return{message:"Password reset email sent. Please check your inbox."}}static async updatePassword(e){let{error:s}=await i.ND.auth.updateUser({password:e});if(s)throw{message:s.message,code:s.message};return{message:"Password updated successfully."}}}var u=t(18991);function c(){let[e,s]=(0,r.fp)(u.p9),[t,o]=(0,r.fp)(u.Se),[c,d]=(0,r.fp)(u.yN);(0,a.useEffect)(()=>{let e=!0;(async()=>{try{o(!0);let t=await l.getCurrentSession();e&&s((null==t?void 0:t.user)||null)}catch(t){console.error("Auth initialization failed:",t),e&&s(null)}finally{e&&o(!1)}})();let{data:{subscription:t}}=(0,i.Bh)(async(t,a)=>{if(e)try{if("SIGNED_OUT"!==t&&a){if("SIGNED_IN"===t||"TOKEN_REFRESHED"===t)try{let e=await l.getCurrentSession();s((null==e?void 0:e.user)||null)}catch(e){if(console.warn("Backend sync failed:",e),a.user){var r,n,i;s({id:a.user.id,email:a.user.email,name:null==(r=a.user.user_metadata)?void 0:r.name,avatarUrl:null==(n=a.user.user_metadata)?void 0:n.avatar_url,role:(null==(i=a.user.user_metadata)?void 0:i.role)||"TENANT",emailVerified:!!a.user.email_confirmed_at,createdAt:a.user.created_at,updatedAt:a.user.updated_at,supabaseId:a.user.id,phone:null,bio:null,stripeCustomerId:null,organizationId:null})}}}else s(null),d(null)}catch(e){console.error("Auth state change error:",e)}});return()=>{e=!1,t.unsubscribe()}},[s,o,d]);let h=(0,a.useCallback)(async e=>{try{o(!0),d(null);let t=await l.login(e);return s(t.user),n.oR.success("Welcome back!"),{success:!0}}catch(s){let e={type:"AUTH_ERROR",message:s instanceof Error?s.message:"Login failed",code:s instanceof Error&&"code"in s?s.code:"AUTH_ERROR"};return d(e),n.oR.error(e.message),{success:!1,error:e}}finally{o(!1)}},[s,o,d]),p=(0,a.useCallback)(async e=>{try{o(!0),d(null);let s=await l.signup(e);return n.oR.success(s.message),{success:!0,message:s.message}}catch(s){let e={type:"AUTH_ERROR",message:s instanceof Error?s.message:"Signup failed",code:s instanceof Error&&"code"in s?s.code:"AUTH_ERROR"};return d(e),n.oR.error(e.message),{success:!1,error:e}}finally{o(!1)}},[o,d]);return{user:e,loading:t,error:c,isAuthenticated:!!e,login:h,signup:p,logout:(0,a.useCallback)(async()=>{try{o(!0),await l.logout(),s(null),d(null),n.oR.success("Logged out successfully")}catch(e){console.error("Logout error:",e),s(null),d(null)}finally{o(!1)}},[s,o,d]),resetPassword:(0,a.useCallback)(async e=>{try{o(!0),d(null);let s=await l.resetPassword(e);return n.oR.success(s.message),{success:!0,message:s.message}}catch(s){let e={type:"AUTH_ERROR",message:s instanceof Error?s.message:"Password reset failed",code:s instanceof Error&&"code"in s?s.code:"AUTH_ERROR"};return d(e),n.oR.error(e.message),{success:!1,error:e}}finally{o(!1)}},[o,d])}}let d=()=>{let{user:e,loading:s,error:t}=c();return{data:e,isLoading:s,error:t}}}}]);