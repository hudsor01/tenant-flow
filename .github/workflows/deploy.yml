name: Deploy

on:
  push:
    branches: [main]
  workflow_dispatch:

env:
  NODE_VERSION: '22.x'

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    timeout-minutes: 4
    environment: production
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Deploy Frontend & Backend
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: |
          npm i -g vercel@latest
          
          # Deploy frontend (tenantflow.app)
          cd apps/frontend
          vercel --prod --token=${{ secrets.VERCEL_TOKEN }}
          
          # Deploy backend (api.tenantflow.app)  
          cd ../../
          vercel --prod --token=${{ secrets.VERCEL_TOKEN }}