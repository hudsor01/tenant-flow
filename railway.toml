[build]
builder = "DOCKERFILE"
dockerfilePath = "./Dockerfile"
# Enable Railway build caching
buildCache = true
# Watch all monorepo packages for changes
watchPaths = [
  "apps/backend/**",
  "packages/shared/**", 
  "packages/database/**",
  "packages/typescript-config/**",
  "package.json",
  "package-lock.json",
  "turbo.json",
  "Dockerfile",
  ".dockerignore"
]

[deploy]
# Use full path for distroless container node executable
startCommand = "/nodejs/bin/node apps/backend/dist/main.js"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
healthcheckPath = "/ping"
healthcheckTimeout = 60
# Give more time for NestJS to start up
waitForPort = 60

[variables]
NODE_ENV = "production"
PORT = "${{ PORT }}"
