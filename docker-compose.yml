services:
  tenantflow-backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: tenantflow-backend
    restart: unless-stopped
    environment:
      - NODE_ENV=production
      - PORT=4600
      - DATABASE_URL=${DATABASE_URL}
      - JWT_SECRET=${JWT_SECRET}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - SUPABASE_JWT_SECRET=${SUPABASE_JWT_SECRET}
      - CORS_ORIGINS=https://tenantflow.app,https://www.tenantflow.app
      - FRONTEND_URL=https://tenantflow.app
      - API_URL=https://ozn8zp4l.up.railway.app
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.tenantflow-api.rule=Host(`api.tenantflow.app`)"
      - "traefik.http.routers.tenantflow-api.tls=true"
      - "traefik.http.routers.tenantflow-api.tls.certresolver=letsencrypt"
      - "traefik.http.services.tenantflow-api.loadbalancer.server.port=4600"
      - "traefik.http.routers.tenantflow-api.entrypoints=websecure"
    networks:
      - traefik

networks:
  traefik:
    external: true