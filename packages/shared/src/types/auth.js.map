{"version":3,"file":"auth.js","sourceRoot":"","sources":["auth.ts"],"names":[],"mappings":";;;AAoBA,8CAQC;AARD,SAAgB,iBAAiB,CAChC,IAAc;IAEd,MAAM,WAAW,GAAG,IAA8C,CAAA;IAClE,OAAO,CACN,OAAO,WAAW,CAAC,cAAc,KAAK,QAAQ;QAC9C,WAAW,CAAC,cAAc,CAAC,MAAM,GAAG,CAAC,CACrC,CAAA;AACF,CAAC;AA0QY,QAAA,UAAU,GAAG;IACzB,eAAe,EAAE,iBAAiB;IAClC,gBAAgB,EAAE,kBAAkB;IACpC,iBAAiB,EAAE,mBAAmB;IACtC,YAAY,EAAE,cAAc;IAC5B,aAAa,EAAE,eAAe;IAC9B,cAAc,EAAE,gBAAgB;IAChC,WAAW,EAAE,aAAa;IAC1B,YAAY,EAAE,cAAc;IAC5B,aAAa,EAAE,eAAe;IAC9B,gBAAgB,EAAE,kBAAkB;IACpC,iBAAiB,EAAE,mBAAmB;IACtC,kBAAkB,EAAE,oBAAoB;IACxC,cAAc,EAAE,gBAAgB;IAChC,eAAe,EAAE,iBAAiB;IAClC,YAAY,EAAE,cAAc;IAC5B,cAAc,EAAE,gBAAgB;IAChC,YAAY,EAAE,cAAc;CACnB,CAAA","sourcesContent":["/**\n * Authentication and user management types\n * All types related to users, authentication, and user roles\n */\n\n// Import constants from the single source of truth\nimport type { USER_ROLE } from '../constants/auth.js'\nimport type { authUser as BackendauthUser } from './backend-domain.js'\n\n// Use Supabase User type directly - matches what we get from auth\nimport type { User } from '@supabase/supabase-js'\nexport type authUser = User\n\n// User role type derived from constants\nexport type UserRole = (typeof USER_ROLE)[keyof typeof USER_ROLE]\n\n// Use Supabase SubStatus instead of custom SubscriptionStatus\nimport type { Database } from './supabase-generated.js'\nexport type SubscriptionStatus = Database['public']['Enums']['SubStatus']\n\nexport function hasOrganizationId(\n\tuser: authUser\n): user is authUser & { organizationId: string } {\n\tconst userWithOrg = user as authUser & { organizationId?: string }\n\treturn (\n\t\ttypeof userWithOrg.organizationId === 'string' &&\n\t\tuserWithOrg.organizationId.length > 0\n\t)\n}\n\nexport interface LoginFormData {\n\temail: string\n\tpassword: string\n\trememberMe?: boolean\n}\n\nexport interface SignupFormData {\n\temail: string\n\tpassword: string\n\tconfirmPassword: string\n\tfullName: string\n\tfirstName?: string\n\tlastName?: string\n\tcompany?: string\n\tcompanyName?: string\n\tacceptTerms: boolean\n}\n\nexport interface ForgotPasswordFormData {\n\temail: string\n}\n\nexport interface ResetPasswordFormData {\n\tpassword: string\n\tconfirmPassword: string\n}\n\nexport interface UpdatePasswordFormData {\n\tcurrentPassword: string\n\tnewPassword: string\n\tconfirmPassword: string\n}\n\nexport interface ProfileFormData {\n\tname: string\n\temail: string\n\tphone?: string\n\tcompany?: string\n\taddress?: string\n\tavatar?: string\n}\n\nexport interface ContactFormData {\n\tname: string\n\temail: string\n\tsubject: string\n\tmessage: string\n\tphone?: string\n}\n\n// Auth request/response types for API\nexport interface LoginCredentials {\n\temail: string\n\tpassword: string\n}\n\nexport interface RegisterCredentials {\n\temail: string\n\tpassword: string\n\tfullName?: string\n}\n\n// Client-side auth action types\nexport interface SignupData {\n\temail: string\n\tpassword: string\n\tfirstName: string\n\tlastName: string\n\tcompany?: string\n}\n\nexport interface ClientAuthResponse {\n\tsuccess: boolean\n\terror?: string\n\tdata?: unknown\n}\n\nexport interface AuthResponse {\n\tuser: User | authUser\n\tsession?: {\n\t\taccess_token: string\n\t\trefresh_token: string\n\t\texpires_in: number\n\t\texpires_at?: number\n\t}\n\tmessage?: string\n}\n\nexport interface RefreshTokenRequest {\n\trefresh_token: string\n}\n\n// Secure subscription data type\nexport interface SecureSubscriptionData {\n\tstatus: SubscriptionStatus\n\tplan: string\n\texpiresAt?: Date\n\tstripeSubscriptionId?: string\n\ttrialEndsAt?: Date\n\tcancelAtPeriodEnd?: boolean\n}\n\n// Enhanced user metadata with validation\nexport interface SecureUserMetadata {\n\tname?: string\n\tfull_name?: string\n\tavatar_url?: string\n\tcompany_name?: string\n\tcompany_type?: 'OWNER' | 'PROPERTY_MANAGER' | 'TENANT' | 'VENDOR'\n\tcompany_size?: '1-10' | '11-50' | '51-200' | '201+'\n\tonboarding_completed?: boolean\n\tterms_accepted_at?: string\n\tprivacy_policy_accepted_at?: string\n}\n\n// Authentication error types\nexport type AuthErrorCode =\n\t| 'INVALID_CREDENTIALS'\n\t| 'USER_NOT_FOUND'\n\t| 'EMAIL_NOT_VERIFIED'\n\t| 'ACCOUNT_LOCKED'\n\t| 'PASSWORD_TOO_WEAK'\n\t| 'EMAIL_ALREADY_EXISTS'\n\t| 'INVALID_TOKEN'\n\t| 'TOKEN_EXPIRED'\n\t| 'RATE_LIMITED'\n\t| 'NETWORK_ERROR'\n\t| 'VALIDATION_ERROR'\n\t| 'UNKNOWN_ERROR'\n\nexport interface AuthError {\n\tcode: AuthErrorCode\n\tmessage: string\n\tfield?: string\n\tdetails?: Record<string, string | number | boolean>\n}\n\n// Use Supabase Session type directly - no custom interface needed\nimport type { Session } from '@supabase/supabase-js'\nexport type AuthSession = Session\n\nexport interface SignupCredentials {\n\temail: string\n\tpassword: string\n\tname: string\n}\n\nexport interface SupabaseJwtPayload {\n\tsub: string // Supabase user ID\n\temail: string\n\temail_confirmed_at?: string\n\tconfirmed_at?: string\n\tlast_sign_in_at?: string\n\tcreated_at?: string\n\tupdated_at?: string\n\tuser_metadata?: SecureUserMetadata\n\tapp_metadata?: {\n\t\tprovider?: string\n\t\tproviders?: string[]\n\t\trole?: UserRole\n\t}\n\tiat: number\n\texp: number\n\taud?: string\n\tiss?: string\n}\n\n// Standard JWT Payload\nexport interface JwtPayload {\n\tsub: string\n\temail: string\n\trole?: UserRole\n\tiat?: number\n\texp?: number\n}\n\n// Google OAuth user type - extends Supabase's User with Google-specific fields\nexport interface GoogleOAuthUser extends authUser {\n\tname?: string\n\tpicture?: string\n}\n\n// Backend auth request/response schemas\nexport interface LoginRequest {\n\temail: string\n\tpassword: string\n\trememberMe?: boolean\n}\n\nexport interface RegisterRequest {\n\temail: string\n\tpassword: string\n\tfullName?: string\n\tcompanyName?: string\n}\n\nexport interface ForgotPasswordRequest {\n\temail: string\n}\n\nexport interface ResetPasswordRequest {\n\tpassword: string\n\ttoken: string\n}\n\nexport interface ChangePasswordRequest {\n\tcurrentPassword: string\n\tnewPassword: string\n}\n\n// Extended auth context and guard types\n// MIGRATED from apps/backend/src/shared/guards/auth.guard.ts\nexport interface AuthenticatedRequest {\n\tuser: BackendauthUser\n\t// Additional authenticated request context could be added here with specific types\n}\n\n// MIGRATED from apps/backend/src/shared/guards/roles.guard.ts\nexport interface RequestWithUser {\n\tuser?: User & { organizationId?: string }\n\tparams?: Record<string, string>\n\tquery?: Record<string, string>\n\tbody?: Record<string, string | number | boolean | null> // HTTP request bodies have constrained JSON values\n\tip?: string\n\troute?: { path?: string }\n\tmethod?: string\n}\n\n// MIGRATED from apps/backend/src/shared/guards/throttler-proxy.guard.ts\nexport interface ThrottlerRequest {\n\theaders: Record<string, string | string[] | undefined>\n\tip?: string\n\tsocket?: { remoteAddress?: string }\n}\n\n// MIGRATED from apps/backend/src/auth/auth-webhook.controller.ts\nexport interface SupabaseWebhookEvent {\n\ttype: 'INSERT' | 'UPDATE' | 'DELETE'\n\ttable: string\n\tschema: 'auth' | 'public'\n\trecord: {\n\t\tid: string\n\t\temail?: string\n\t\temail_confirmed_at?: string | null\n\t\tuser_metadata?: {\n\t\t\tname?: string\n\t\t\tfull_name?: string\n\t\t}\n\t\tcreated_at: string\n\t\tupdated_at: string\n\t}\n}\n\nexport interface AuthContextType {\n\tuser: authUser | null\n\tloading: boolean\n\tsignIn: (credentials: LoginCredentials) => Promise<void>\n\tsignOut: () => Promise<void>\n\tsignUp: (credentials: SignupCredentials) => Promise<void>\n}\n\n// Permission and role enums (consolidated from security.ts)\n\n// Use const object instead of TypeScript enum (ENUM STANDARDIZATION compliance)\nexport const Permission = {\n\tREAD_PROPERTIES: 'READ_PROPERTIES',\n\tWRITE_PROPERTIES: 'WRITE_PROPERTIES',\n\tDELETE_PROPERTIES: 'DELETE_PROPERTIES',\n\tREAD_TENANTS: 'READ_TENANTS',\n\tWRITE_TENANTS: 'WRITE_TENANTS',\n\tDELETE_TENANTS: 'DELETE_TENANTS',\n\tREAD_LEASES: 'READ_LEASES',\n\tWRITE_LEASES: 'WRITE_LEASES',\n\tDELETE_LEASES: 'DELETE_LEASES',\n\tREAD_MAINTENANCE: 'READ_MAINTENANCE',\n\tWRITE_MAINTENANCE: 'WRITE_MAINTENANCE',\n\tDELETE_MAINTENANCE: 'DELETE_MAINTENANCE',\n\tREAD_FINANCIAL: 'READ_FINANCIAL',\n\tWRITE_FINANCIAL: 'WRITE_FINANCIAL',\n\tADMIN_ACCESS: 'ADMIN_ACCESS',\n\tMANAGE_BILLING: 'MANAGE_BILLING',\n\tMANAGE_USERS: 'MANAGE_USERS'\n} as const\n\nexport type PermissionValue = (typeof Permission)[keyof typeof Permission]\n\n// Security validation and context types\nexport interface SecurityValidationResult {\n\tisValid: boolean\n\terrors: string[]\n\twarnings: string[]\n}\n\nexport interface AuthContext {\n\tuser: User | null\n\tpermissions: PermissionValue[]\n\troles: UserRole[]\n}\n\n// Form state type alias for auth forms\nimport type { FormState } from './forms.js'\nexport type AuthFormState = FormState<User>\n\n// FRONTEND AUTH STORE STATE (moved from auth-store.ts)\n\n// Frontend auth store state for Zustand (compatible with Supabase types)\nexport interface AuthState {\n\tuser: authUser | null // Support both Supabase User and authUser\n\tsession: AuthSession | null // Use AuthSession for Supabase compatibility\n\tisAuthenticated: boolean\n\tisLoading: boolean\n\tsetUser: (user: authUser | null) => void\n\tsetSession: (session: AuthSession | null) => void\n\tsetLoading: (loading: boolean) => void\n\tsignOut: () => void\n}\n\n// AUTH FORM PROPS TYPES\n\nexport interface AuthFormProps {\n\tonSubmit?: (data: LoginFormData | SignupFormData) => Promise<void> | void\n\tonForgotPassword?: () => void\n\tonSignUp?: () => void\n\tonLogin?: () => void\n\tonGoogleLogin?: () => Promise<void> | void\n\tonGoogleSignUp?: () => Promise<void> | void\n\tisLoading?: boolean\n\tisGoogleLoading?: boolean\n\tclassName?: string\n}\n\n// LOGIN LAYOUT PROPS - UI component configuration\nexport interface LoginLayoutProps {\n\tmode?: 'login' | 'signup'\n\timageOnRight?: boolean\n\timageUrl?: string\n\tauthProps?: AuthFormProps\n\ttitle?: string\n\tsubtitle?: string\n\tcontent?: {\n\t\theading: string\n\t\tdescription: string\n\t\tstats: Array<{ value: string; label: string }>\n\t}\n\tclassName?: string\n}\n"]}