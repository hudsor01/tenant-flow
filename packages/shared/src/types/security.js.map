{"version":3,"file":"security.js","sourceRoot":"","sources":["security.ts"],"names":[],"mappings":";;;AAMA,gDAAgD;AAAvC,oGAAA,SAAS,OAAA;AAMlB,IAAY,iBAmDX;AAnDD,WAAY,iBAAiB;IAE5B,kDAA6B,CAAA;IAC7B,kDAA6B,CAAA;IAC7B,kDAA6B,CAAA;IAC7B,8DAAyC,CAAA;IACzC,wDAAmC,CAAA;IACnC,wDAAmC,CAAA;IACnC,oDAA+B,CAAA;IAC/B,gEAA2C,CAAA;IAC3C,sDAAiC,CAAA;IAGjC,4DAAuC,CAAA;IACvC,0DAAqC,CAAA;IACrC,8DAAyC,CAAA;IACzC,8DAAyC,CAAA;IAGzC,8DAAyC,CAAA;IACzC,sEAAiD,CAAA;IACjD,4DAAuC,CAAA;IACvC,oEAA+C,CAAA;IAC/C,gDAA2B,CAAA;IAC3B,kDAA6B,CAAA;IAC7B,sDAAiC,CAAA;IACjC,gEAA2C,CAAA;IAC3C,gEAA2C,CAAA;IAC3C,gEAA2C,CAAA;IAC3C,oEAA+C,CAAA;IAG/C,gEAA2C,CAAA;IAC3C,gEAA2C,CAAA;IAC3C,8DAAyC,CAAA;IACzC,8DAAyC,CAAA;IAGzC,kDAA6B,CAAA;IAC7B,gDAA2B,CAAA;IAC3B,kEAA6C,CAAA;IAC7C,oDAA+B,CAAA;IAC/B,8CAAyB,CAAA;IACzB,kDAA6B,CAAA;IAG7B,sEAAiD,CAAA;IACjD,4EAAuD,CAAA;IACvD,gEAA2C,CAAA;IAC3C,sEAAiD,CAAA;IACjD,sEAAiD,CAAA;AAClD,CAAC,EAnDW,iBAAiB,iCAAjB,iBAAiB,QAmD5B;AAKD,IAAY,qBAKX;AALD,WAAY,qBAAqB;IAChC,oCAAW,CAAA;IACX,0CAAiB,CAAA;IACjB,sCAAa,CAAA;IACb,8CAAqB,CAAA;AACtB,CAAC,EALW,qBAAqB,qCAArB,qBAAqB,QAKhC","sourcesContent":["/**\n * Security-related types shared between frontend and backend\n */\n\n// User roles are consolidated in auth.ts - import from there\n// This ensures single source of truth and prevents duplication\nexport { USER_ROLE } from '../constants/auth.js'\nexport type { Permission, UserRole } from '../types/auth.js'\n\n/**\n * Comprehensive security event types for monitoring\n */\nexport enum SecurityEventType {\n\t// Authentication events\n\tAUTH_ATTEMPT = 'AUTH_ATTEMPT',\n\tAUTH_SUCCESS = 'AUTH_SUCCESS',\n\tAUTH_FAILURE = 'AUTH_FAILURE',\n\tAUTH_TOKEN_INVALID = 'AUTH_TOKEN_INVALID',\n\tAUTH_RATE_LIMIT = 'AUTH_RATE_LIMIT',\n\tPASSWORD_CHANGE = 'PASSWORD_CHANGE',\n\tTOKEN_REFRESH = 'TOKEN_REFRESH',\n\tSESSION_INVALIDATED = 'SESSION_INVALIDATED',\n\tACCOUNT_LOCKED = 'ACCOUNT_LOCKED',\n\n\t// Authorization events\n\tPERMISSION_DENIED = 'PERMISSION_DENIED',\n\tFORBIDDEN_ACCESS = 'FORBIDDEN_ACCESS',\n\tRLS_BYPASS_ATTEMPT = 'RLS_BYPASS_ATTEMPT',\n\tUNAUTHORIZED_QUERY = 'UNAUTHORIZED_QUERY',\n\n\t// Input validation & security threats\n\tVALIDATION_FAILURE = 'VALIDATION_FAILURE',\n\tINVALID_INPUT_DETECTED = 'INVALID_INPUT_DETECTED',\n\tINJECTION_ATTEMPT = 'INJECTION_ATTEMPT',\n\tSQL_INJECTION_ATTEMPT = 'SQL_INJECTION_ATTEMPT',\n\tXSS_ATTEMPT = 'XSS_ATTEMPT',\n\tCSRF_ATTEMPT = 'CSRF_ATTEMPT',\n\tPATH_TRAVERSAL = 'PATH_TRAVERSAL',\n\tFILE_UPLOAD_BLOCKED = 'FILE_UPLOAD_BLOCKED',\n\tFILE_TYPE_VIOLATION = 'FILE_TYPE_VIOLATION',\n\tFILE_SIZE_VIOLATION = 'FILE_SIZE_VIOLATION',\n\tMALICIOUS_FILE_UPLOAD = 'MALICIOUS_FILE_UPLOAD',\n\n\t// Rate limiting & suspicious activity\n\tRATE_LIMIT_EXCEEDED = 'RATE_LIMIT_EXCEEDED',\n\tSUSPICIOUS_ACTIVITY = 'SUSPICIOUS_ACTIVITY',\n\tSUSPICIOUS_REQUEST = 'SUSPICIOUS_REQUEST',\n\tSUSPICIOUS_PATTERN = 'SUSPICIOUS_PATTERN',\n\n\t// Administrative & system events\n\tADMIN_ACTION = 'ADMIN_ACTION',\n\tDATA_EXPORT = 'DATA_EXPORT',\n\tCONFIGURATION_CHANGE = 'CONFIGURATION_CHANGE',\n\tCONFIG_ACCESS = 'CONFIG_ACCESS',\n\tPII_ACCESS = 'PII_ACCESS',\n\tSYSTEM_ERROR = 'SYSTEM_ERROR',\n\n\t// Additional security event types for comprehensive monitoring\n\tSESSION_HIJACK_ATTEMPT = 'SESSION_HIJACK_ATTEMPT',\n\tCOMMAND_INJECTION_ATTEMPT = 'COMMAND_INJECTION_ATTEMPT',\n\tBRUTE_FORCE_ATTEMPT = 'BRUTE_FORCE_ATTEMPT',\n\tPATH_TRAVERSAL_ATTEMPT = 'PATH_TRAVERSAL_ATTEMPT',\n\tSECURITY_CONFIG_CHANGE = 'SECURITY_CONFIG_CHANGE'\n}\n\n/**\n * Security event severity levels\n */\nexport enum SecurityEventSeverity {\n\tLOW = 'LOW',\n\tMEDIUM = 'MEDIUM',\n\tHIGH = 'HIGH',\n\tCRITICAL = 'CRITICAL'\n}\n\n/**\n * Security event for logging and monitoring\n */\nexport interface SecurityEvent {\n\ttype: SecurityEventType\n\tseverity: SecurityEventSeverity\n\tuserId?: string\n\tdetails?: string\n\tmetadata?: SecurityEventMetadata\n\tipAddress?: string\n\tuserAgent?: string\n\ttimestamp?: Date\n}\n\n/**\n * Security audit log entry\n */\nexport interface SecurityAuditLog {\n\tid?: string\n\teventType: SecurityEventType\n\tseverity: SecurityEventSeverity\n\tuserId?: string\n\tdetails: string\n\tmetadata?: SecurityEventMetadata\n\tipAddress?: string\n\tuserAgent?: string\n\ttimestamp?: Date\n\temail?: string\n\tresource?: string\n\taction?: string\n}\n\n/**\n * Security metrics for monitoring\n */\nexport interface SecurityTrendPoint {\n\tdate: string\n\ttotalEvents: number\n\tcriticalEvents: number\n}\n\nexport interface SecurityThreatSummary {\n\tip: string\n\tcount: number\n}\n\nexport interface SecurityMetrics {\n\ttotalEvents: number\n\teventsByType: Record<SecurityEventType, number>\n\teventsBySeverity: Record<SecurityEventSeverity, number>\n\tcriticalEvents: number\n\trecentEvents: SecurityEvent[]\n\trecentTrends?: SecurityTrendPoint[]\n\ttopThreateningIPs?: SecurityThreatSummary[]\n\tsuspiciousIPs?: string[]\n\tfailedAuthAttempts?: number\n\tblockedRequests?: number\n\ttimeRange?: {\n\t\tstart: Date\n\t\tend: Date\n\t}\n}\n\n/**\n * Security validation result with constrained data types\n */\nexport type SecureDataType =\n\t| string\n\t| number\n\t| boolean\n\t| null\n\t| Array<string | number | boolean | null>\n\t| Record<string, string | number | boolean | null>\n\nexport interface SecurityValidationResult<\n\tT extends SecureDataType = SecureDataType\n> {\n\tisValid: boolean\n\tdata?: T\n\terrors?: string[]\n\tsanitizedInput?: T\n\tviolationDetails?: {\n\t\triskLevel: SecurityEventSeverity\n\t\tdetectedPatterns: string[]\n\t\tsanitizationApplied: boolean\n\t}\n}\n\n/**\n * Compliance monitoring status and metrics\n */\nexport interface ComplianceStatus {\n\toverallScore: number\n\tfairHousingStatus?: {\n\t\triskLevel?: SecurityEventSeverity\n\t\tscore?: number\n\t\tviolations?: number\n\t}\n\tdataRetentionStatus?: {\n\t\toverdueRecords?: number\n\t\tscore?: number\n\t\triskLevel?: SecurityEventSeverity\n\t}\n\tsecurityStatus?: {\n\t\tcriticalEvents?: number\n\t\tscore?: number\n\t\triskLevel?: SecurityEventSeverity\n\t}\n\trecentAlerts?: SecurityEvent[]\n\trecommendations?: string[]\n}\n\n/**\n * Security header configuration for CSP and other security policies\n */\nexport interface SecurityHeaderConfig {\n\tcontentSecurityPolicy: CSPDirectives\n\tpermissionsPolicy: PermissionsPolicyDirectives\n\tstrictTransportSecurity: HSTSConfig\n\tcrossOriginPolicies: CrossOriginConfig\n}\n\n/**\n * Content Security Policy directives with type safety\n */\nexport interface CSPDirectives {\n\t'default-src': string[]\n\t'script-src': string[]\n\t'style-src': string[]\n\t'img-src': string[]\n\t'font-src': string[]\n\t'connect-src': string[]\n\t'frame-src': string[]\n\t'worker-src'?: string[]\n\t'object-src': string[]\n\t'base-uri': string[]\n\t'form-action': string[]\n\t'frame-ancestors': string[]\n\t'upgrade-insecure-requests'?: boolean\n\t'block-all-mixed-content'?: boolean\n}\n\n/**\n * Permissions Policy configuration\n */\nexport interface PermissionsPolicyDirectives {\n\tcamera: string\n\tmicrophone: string\n\tgeolocation: string\n\tgyroscope: string\n\tmagnetometer: string\n\tpayment: string\n\tusb: string\n\t'interest-cohort': string\n\t'browsing-topics': string\n\t'attribution-reporting': string\n\t'trust-token-redemption': string\n\tfullscreen: string\n\t'picture-in-picture': string\n\taccelerometer: string\n\t'ambient-light-sensor': string\n\tautoplay: string\n\t'clipboard-read': string\n\t'clipboard-write': string\n\t'display-capture': string\n\t'document-domain': string\n\t'encrypted-media': string\n\t'execution-while-not-rendered': string\n\t'execution-while-out-of-viewport': string\n\tgamepad: string\n\thid: string\n\t'idle-detection': string\n\t'local-fonts': string\n\tmidi: string\n\t'navigation-override': string\n\t'otp-credentials': string\n\t'publickey-credentials-create': string\n\t'publickey-credentials-get': string\n\t'screen-wake-lock': string\n\tserial: string\n\t'speaker-selection': string\n\t'storage-access': string\n\t'web-share': string\n\t'window-management': string\n\t'xr-spatial-tracking': string\n}\n\n/**\n * HTTP Strict Transport Security configuration\n */\nexport interface HSTSConfig {\n\tmaxAge: number\n\tincludeSubDomains: boolean\n\tpreload: boolean\n}\n\n/**\n * Cross-origin policy configuration\n */\nexport interface CrossOriginConfig {\n\tembedderPolicy: 'unsafe-none' | 'require-corp'\n\topenerPolicy: 'unsafe-none' | 'same-origin-allow-popups' | 'same-origin'\n\tresourcePolicy: 'same-site' | 'same-origin' | 'cross-origin'\n}\n\n/**\n * CSP nonce management types\n */\nexport interface CSPNonceData {\n\tnonce: string\n\texpires: number\n\tsessionId?: string\n}\n\n/**\n * CSP violation report structure - Re-export from domain.ts (primary source)\n */\nexport type { CSPViolationReport } from './domain.js'\n\n/**\n * Security data classification types\n */\nexport type DataClassificationType =\n\t| 'PII' // Personally identifiable information\n\t| 'PHI' // Protected health information\n\t| 'FINANCIAL' // Financial/payment data\n\t| 'CREDENTIALS' // Authentication credentials\n\t| 'LEGAL' // Legal documents/contracts\n\t| 'OPERATIONAL' // Business operational data\n\t| 'PUBLIC' // Public information\n\n/**\n * Type-safe user metadata for authentication\n */\nexport interface SecureAppMetadata {\n\tprovider?: string\n\tproviders?: string[]\n\trole?: string\n\torganizationId?: string\n\tpermissions?: string[]\n}\n\n/**\n * Type-safe user metadata for profiles - Re-export from auth.ts (primary source)\n */\nexport type { SecureUserMetadata } from './auth.js'\n\n/**\n * Security event metadata with typed fields\n */\nexport interface SecurityEventMetadata {\n\t// Network security\n\tipAddress?: string\n\tuserAgent?: string\n\trequestId?: string\n\n\t// Authentication context\n\tsessionId?: string\n\trefreshTokenId?: string\n\tmfaUsed?: boolean\n\tloginMethod?: 'password' | 'oauth' | 'magic_link' | 'otp'\n\n\t// Device context\n\tdeviceFingerprint?: string\n\tdeviceType?: 'desktop' | 'mobile' | 'tablet' | 'unknown'\n\tplatform?: string\n\tbrowser?: string\n\n\t// File security\n\tfileName?: string\n\tfileSize?: number\n\tfileType?: string\n\tfilePath?: string\n\tfileHash?: string\n\tscanResult?: 'clean' | 'infected' | 'suspicious' | 'error'\n\n\t// Application context\n\tfeature?: string\n\taction?: string\n\tresource?: string\n\tpreviousState?: string\n\tnewState?: string\n\n\t// Error context\n\terrorCode?: string\n\terrorMessage?: string\n\tstackTrace?: string\n\n\t// Compliance context\n\tgdprBasis?:\n\t\t| 'consent'\n\t\t| 'contract'\n\t\t| 'legal_obligation'\n\t\t| 'vital_interests'\n\t\t| 'public_task'\n\t\t| 'legitimate_interests'\n\tretentionPeriod?: number\n\tanonymizationRequired?: boolean\n\n\t// Application-specific context\n\tcontext?: string\n\tquarantineReason?: string\n\tconfigChangeType?: string\n\tpreviousConfig?: unknown\n\tupdates?: unknown\n}\n"]}