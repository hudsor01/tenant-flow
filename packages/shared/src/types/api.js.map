{"version":3,"file":"api.js","sourceRoot":"","sources":["api.ts"],"names":[],"mappings":"","sourcesContent":["// File: packages/shared/api.ts\n// Purpose: Shared API DTOs and response types for frontend and backend.\n\nimport type { Database } from './supabase-generated.js'\nimport type { User } from './supabase.js'\ntype Lease = Database['public']['Tables']['lease']['Row']\ntype Property = Database['public']['Tables']['property']['Row']\ntype Unit = Database['public']['Tables']['unit']['Row']\ntype Tenant = Database['public']['Tables']['tenant']['Row']\n// MaintenanceRequest type available if needed: Database['public']['Tables']['maintenance_request']['Row']\nimport type { ControllerApiResponse as _ControllerApiResponse } from './errors.js'\n\nexport type { _ControllerApiResponse as ControllerApiResponse }\n// Response types moved to core.ts - using ApiResponse pattern instead\n\n// Note: Core types (User, Lease, Property, etc.) are exported from their own files\n// Note: Error types are exported from errors.ts\n// Note: Response types are exported from responses.ts\n// This file contains only API-specific types to avoid re-export conflicts\n\n// Note: ApiResponse types moved to responses.ts to avoid conflicts\n\nexport interface ApiError {\n\tmessage: string\n\tstatusCode: number\n\terror?: string\n}\n\n// Frontend API client types (consolidated from apps/frontend/src/lib/api-client.ts)\nexport interface FrontendApiError {\n\tmessage: string\n\tcode?: string\n\tdetails?: Record<string, unknown>\n\ttimestamp?: string\n}\n\nexport interface RequestConfig {\n\tparams?: Record<string, string | number | boolean | string[] | undefined>\n\theaders?: Record<string, string>\n\tsignal?: AbortSignal\n}\n\n// Authentication types\nexport interface AuthCredentials {\n\temail: string\n\tpassword: string\n}\n\nexport interface RegisterData extends AuthCredentials {\n\tname: string\n\tconfirmPassword: string\n}\n\n// Note: AuthResponse is defined in auth.ts\n\nexport type { RefreshTokenRequest } from './auth'\n\n// User API types\nexport type UserProfileResponse = User\n\nexport interface UpdateUserProfileDto {\n\tname?: string | null\n\tphone?: string | null\n\tbio?: string | null\n\tavatarUrl?: string | null\n}\n\n// Alternative naming for consistency with frontend\nexport interface UpdateUserProfileInput {\n\tname?: string | null\n\tphone?: string | null\n\tbio?: string | null\n\tavatarUrl?: string | null\n\tfullName?: string | null\n\tcompany?: string | null\n}\n\n// Note: Property, Tenant, Unit, and Lease input types are defined in api-inputs.ts\n// Import them from there instead\n\n// Import from api-inputs.ts for consistent type usage\nimport type {\n\tCreateLeaseInput,\n\tCreatePropertyInput,\n\tCreateTenantInput,\n\tCreateUnitInput,\n\tUpdateLeaseInput,\n\tUpdatePropertyInput,\n\tUpdateTenantInput,\n\tUpdateUnitInput\n} from './api-inputs.js'\n\n// Direct re-exports - use Input types consistently\nexport type {\n\tCreateLeaseInput,\n\tCreatePropertyInput,\n\tCreateTenantInput,\n\tCreateUnitInput,\n\tUpdateLeaseInput,\n\tUpdatePropertyInput,\n\tUpdateTenantInput,\n\tUpdateUnitInput\n}\n\nexport interface UnitStatistics {\n\ttotalUnits: number\n\tavailableUnits: number\n\toccupiedUnits: number\n\tmaintenanceUnits: number\n\taverageRent: number\n\t// Additional properties needed by tests\n\ttotal: number\n\toccupied: number\n\tvacant: number\n\toccupancyRate: number\n}\n\nexport interface LeaseStatistics {\n\ttotalLeases: number\n\tactiveLeases: number\n\texpiredLeases: number\n\tpendingLeases: number\n\ttotalRentRoll: number\n\t// Additional properties needed by tests\n\ttotal: number\n\tactive: number\n}\n\nexport interface ExpiringLease extends Omit<Lease, 'endDate'> {\n\trentAmount: number\n\tendDate: string\n\tunit: Unit & {\n\t\tproperty: Property\n\t}\n\ttenant: Tenant\n\tdaysUntilExpiry: number\n}\n\n// Maintenance API types\nexport interface CreateMaintenanceDto {\n\tunitId: string\n\ttitle: string\n\tdescription: string\n\tpriority?: string\n\tstatus?: string\n}\n\nexport interface UpdateMaintenanceDto {\n\ttitle?: string\n\tdescription?: string\n\tpriority?: string\n\tstatus?: string\n\tassignedTo?: string\n\testimatedCost?: number\n\tactualCost?: number\n\tcompletedAt?: string\n}\n\n// Notification API types\nexport type {\n\tCreateNotificationDto,\n\tUpdateNotificationDto\n} from './notifications'\n\n// File upload types\nexport interface FileUploadResponse {\n\turl: string\n\tpath: string\n\tfilename: string\n\tsize: number\n\tmimeType: string\n}\n\n// Query parameters for API calls - using comprehensive query types from queries.ts\nexport type {\n\tLeaseQuery,\n\tMaintenanceQuery,\n\tNotificationQuery,\n\tPropertyQuery,\n\tTenantQuery,\n\tUnitQuery\n} from './queries.js'\n\n// Note: *WithDetails types are defined in relations.ts to avoid circular imports\n\n// DashboardStats moved to core.ts to follow single source of truth architecture\n\nexport type { ActivityItem } from './activity'\n\nexport interface DashboardActivity {\n\tactivities: {\n\t\tid: string\n\t\ttype: 'property' | 'tenant' | 'lease' | 'maintenance'\n\t\taction: 'created' | 'updated' | 'deleted'\n\t\ttitle: string\n\t\tdescription: string\n\t\ttimestamp: string\n\t\tuserId: string\n\t}[]\n}\n\n// Invitation types\nexport interface InviteTenantDto {\n\tname: string\n\temail: string\n\tphone?: string\n\temergencyContact?: string\n\tpropertyId: string\n\tunitId: string\n}\n\nexport interface InviteTenantData {\n\tname: string\n\temail: string\n\tphone?: string\n\tpropertyId: string\n\tunitId?: string // Optional unit selection\n}\n\nexport interface InvitationResponse {\n\tsuccess: boolean\n\tmessage: string\n\tinvitation?: {\n\t\tid: string\n\t\ttoken: string\n\t\texpiresAt: string\n\t}\n}\n\n// ADDITIONAL API TYPES - MIGRATED from inline definitions\n\nexport interface WebhookClientOptions {\n\tbaseUrl: string\n\tapiKey?: string\n\ttimeout?: number\n\tretries?: number\n}\n\nexport interface ValidationOptions {\n\tstrict?: boolean\n\tstripUnknown?: boolean\n\tallowUnknown?: boolean\n}\n\n// Server Action and Form State types (React 19 patterns)\nexport interface ServerActionState {\n\tsuccess: boolean\n\terror?: string\n\tmessage?: string\n\tdata?: unknown\n}\n\nexport interface UseServerActionOptions<T extends ServerActionState> {\n\tonSuccess?: (data: T) => void\n\tonError?: (error: string) => void\n\tresetOnSuccess?: boolean\n}\n\nexport type ActionResult<T = void> =\n\t| { success: true; data: T; error?: never }\n\t| { success: false; error: string; data?: never }\n\n// Form state management\nexport interface FormState {\n\tsuccess: boolean\n\terror?: string\n\tmessage?: string\n\terrors?: Record<string, string>\n}\n\nexport interface UseActionStateFormOptions<T = Record<string, unknown>> {\n\tresetOnSuccess?: boolean\n\tvalidateOnChange?: boolean\n\tonSuccess?: (data: T) => void\n\tonError?: (errors: Record<string, string>) => void\n}\n\nexport interface UseActionStateFormReturn {\n\tformState: FormState\n\tisSubmitting: boolean\n\tregister: (name: string) => { name: string }\n\thandleSubmit: (\n\t\taction: (prevState: FormState, formData: FormData) => Promise<FormState>\n\t) => (formData: FormData) => void\n\treset: () => void\n}\n\n// Error handling types\nexport type ErrorSeverity = 'low' | 'medium' | 'high' | 'critical'\n\nexport type ErrorType =\n\t| 'VALIDATION_ERROR'\n\t| 'NETWORK_ERROR'\n\t| 'AUTHENTICATION_ERROR'\n\t| 'AUTHORIZATION_ERROR'\n\t| 'NOT_FOUND_ERROR'\n\t| 'CONFLICT_ERROR'\n\t| 'RATE_LIMIT_ERROR'\n\t| 'INTERNAL_ERROR'\n\t| 'EXTERNAL_SERVICE_ERROR'\n\t| 'UNKNOWN_ERROR'\n\nexport interface ExtendedAppError extends Error {\n\tcode: ErrorType\n\tseverity: ErrorSeverity\n\tcontext?: Record<string, unknown>\n\tuserMessage?: string\n\tretryable?: boolean\n\ttimestamp?: Date\n}\n\nexport type AsyncResult<T> =\n\t| { success: true; data: T; error?: never }\n\t| { success: false; error: ExtendedAppError; data?: never }\n\n// API client loading states\nexport interface UseApiCallOptions<TData = unknown> {\n\tonSuccess?: (data: TData) => void\n\tonError?: (error: Error) => void\n\tenabled?: boolean\n\tstaleTime?: number\n}\n\nexport interface UseLoadingStateOptions {\n\tinitialLoading?: boolean\n\ttimeout?: number\n}\n\n// ============================================================================\n// RPC API RESPONSE TYPES - Match actual flattened database query responses\n// ============================================================================\n\n// MaintenanceRequest with flattened joined data (from get_user_maintenance RPC)\nexport interface MaintenanceRequestApiResponse {\n\t// MaintenanceRequest fields\n\tid: string\n\ttitle: string\n\tdescription: string\n\tpriority: 'LOW' | 'MEDIUM' | 'HIGH' | 'URGENT'\n\tstatus: 'OPEN' | 'IN_PROGRESS' | 'COMPLETED' | 'CANCELED' | 'ON_HOLD'\n\tcategory: string | null\n\tunitId: string\n\tactualCost: number | null\n\tallowEntry: boolean\n\tassignedTo: string | null\n\tcompletedAt: string | null\n\tcontactPhone: string | null\n\tcreatedAt: string\n\testimatedCost: number | null\n\tnotes: string | null\n\tphotos: string[] | null\n\tpreferredDate: string | null\n\trequestedBy: string | null\n\tupdatedAt: string\n\n\t// Flattened Unit fields (joined from Unit table)\n\tunitNumber: string\n\tunitBedrooms?: number\n\tunitBathrooms?: number\n\tunitRent?: number\n\tunitStatus?: 'VACANT' | 'OCCUPIED' | 'MAINTENANCE' | 'RESERVED'\n\n\t// Flattened Property fields (joined from Property table via Unit)\n\tpropertyId?: string\n\tpropertyName?: string\n\tpropertyAddress?: string\n\tpropertyCity?: string\n\tpropertyState?: string\n\tpropertyType?:\n\t\t| 'SINGLE_FAMILY'\n\t\t| 'MULTI_UNIT'\n\t\t| 'APARTMENT'\n\t\t| 'COMMERCIAL'\n\t\t| 'CONDO'\n\t\t| 'TOWNHOUSE'\n\t\t| 'OTHER'\n\n\t// Flattened Tenant fields (optional, joined when available)\n\ttenantName?: string\n\ttenantEmail?: string\n\ttenantPhone?: string\n}\n"]}