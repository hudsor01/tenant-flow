{"version":3,"file":"property-analytics.js","sourceRoot":"","sources":["property-analytics.ts"],"names":[],"mappings":"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","sourcesContent":["import type {\n\tPropertyPerformanceEntry,\n\tPropertyPerformancePageResponse,\n\tPropertyPerformanceSummary,\n\tPropertyUnitDetail,\n\tUnitStatisticEntry,\n\tVisitorAnalyticsPoint,\n\tVisitorAnalyticsResponse\n} from '../types/property-analytics.js'\n\nfunction toNumber(value: unknown, fallback = 0): number {\n\tif (typeof value === 'number' && Number.isFinite(value)) {\n\t\treturn value\n\t}\n\n\tif (typeof value === 'string') {\n\t\tconst parsed = Number(value)\n\t\tif (Number.isFinite(parsed)) {\n\t\t\treturn parsed\n\t\t}\n\t}\n\n\treturn fallback\n}\n\nfunction toString(value: unknown, fallback = ''): string {\n\tif (typeof value === 'string') {\n\t\treturn value\n\t}\n\n\tif (typeof value === 'number' || typeof value === 'bigint') {\n\t\treturn String(value)\n\t}\n\n\treturn fallback\n}\n\nfunction isObject(value: unknown): value is Record<string, unknown> {\n\treturn typeof value === 'object' && value !== null\n}\n\nexport function mapPropertyPerformance(\n\tdata: unknown\n): PropertyPerformanceEntry[] {\n\tif (!Array.isArray(data)) {\n\t\treturn []\n\t}\n\n\treturn data.map(item => {\n\t\tconst record = isObject(item) ? item : {}\n\t\tconst propertyName = toString(\n\t\t\trecord.property_name ?? record.propertyName ?? record.property\n\t\t)\n\n\t\tconst trendValue = record.trend ?? record.trend_direction\n\t\tconst trend: 'up' | 'down' | 'stable' =\n\t\t\ttrendValue === 'up' || trendValue === 'down' || trendValue === 'stable'\n\t\t\t\t? trendValue\n\t\t\t\t: 'stable' // Default to stable if not provided\n\t\tconst trendPercentage = toNumber(\n\t\t\trecord.trend_percentage ?? record.trendPercentage,\n\t\t\t0 // Default to 0 if not provided\n\t\t)\n\n\t\treturn {\n\t\t\tpropertyId: toString(\n\t\t\t\trecord.property_id ?? record.propertyId,\n\t\t\t\tpropertyName\n\t\t\t),\n\t\t\tpropertyName,\n\t\t\toccupancyRate: toNumber(record.occupancy_rate ?? record.occupancyRate),\n\t\t\tmonthlyRevenue: toNumber(record.monthly_revenue ?? record.monthlyRevenue),\n\t\t\tannualRevenue: toNumber(record.annual_revenue ?? record.annualRevenue),\n\t\t\ttotalUnits: toNumber(\n\t\t\t\trecord.total_units ?? record.units ?? record.totalUnits\n\t\t\t),\n\t\t\toccupiedUnits: toNumber(\n\t\t\t\trecord.occupied_units ?? record.occupiedUnits ?? record.occupied\n\t\t\t),\n\t\t\tvacantUnits: toNumber(record.vacant_units ?? record.vacantUnits),\n\t\t\taddress: toString(record.address ?? record.formatted_address ?? ''),\n\t\t\tstatus: toString(record.status ?? record.state ?? ''),\n\t\t\tpropertyType: toString(record.property_type ?? record.type ?? ''),\n\t\t\ttrend,\n\t\t\ttrendPercentage\n\t\t}\n\t})\n}\n\nexport function computePropertySummary(\n\tperformance: PropertyPerformanceEntry[]\n): PropertyPerformanceSummary {\n\tif (!performance.length) {\n\t\treturn {\n\t\t\ttotalProperties: 0,\n\t\t\ttotalUnits: 0,\n\t\t\toccupiedUnits: 0,\n\t\t\taverageOccupancy: 0,\n\t\t\ttotalRevenue: 0\n\t\t}\n\t}\n\n\tconst totals = performance.reduce(\n\t\t(acc, item) => {\n\t\t\tacc.totalUnits += item.totalUnits\n\t\t\tacc.occupiedUnits += item.occupiedUnits\n\t\t\tacc.totalRevenue += item.monthlyRevenue\n\t\t\treturn acc\n\t\t},\n\t\t{ totalUnits: 0, occupiedUnits: 0, totalRevenue: 0 }\n\t)\n\n\tconst sortedByOccupancy = [...performance].sort(\n\t\t(a, b) => b.occupancyRate - a.occupancyRate\n\t)\n\n\tconst averageOccupancy =\n\t\tperformance.reduce((acc, item) => acc + item.occupancyRate, 0) /\n\t\tperformance.length\n\n\tconst summary: PropertyPerformanceSummary = {\n\t\ttotalProperties: performance.length,\n\t\ttotalUnits: totals.totalUnits,\n\t\toccupiedUnits: totals.occupiedUnits,\n\t\taverageOccupancy: Number.isFinite(averageOccupancy)\n\t\t\t? Number(averageOccupancy.toFixed(1))\n\t\t\t: 0,\n\t\ttotalRevenue: totals.totalRevenue\n\t}\n\n\tconst bestPerformer = sortedByOccupancy[0]?.propertyName\n\tif (bestPerformer !== undefined) summary.bestPerformer = bestPerformer\n\n\tconst worstPerformer = sortedByOccupancy.at(-1)?.propertyName\n\tif (worstPerformer !== undefined) summary.worstPerformer = worstPerformer\n\n\treturn summary\n}\n\nexport function mapPropertyUnits(data: unknown): PropertyUnitDetail[] {\n\tif (!Array.isArray(data)) {\n\t\treturn []\n\t}\n\n\treturn data.map(item => {\n\t\tconst record = isObject(item) ? item : {}\n\t\treturn {\n\t\t\tpropertyId: toString(record.property_id ?? record.propertyId ?? ''),\n\t\t\tunitId: toString(\n\t\t\t\trecord.unit_id ?? record.unitId ?? toString(record.id ?? '')\n\t\t\t),\n\t\t\tunitNumber: toString(record.unit_number ?? record.unitNumber ?? 'Unit'),\n\t\t\tstatus: toString(\n\t\t\t\trecord.status ?? record.state ?? 'unknown'\n\t\t\t).toUpperCase(),\n\t\t\tbedrooms: record.bedrooms === null ? null : toNumber(record.bedrooms),\n\t\t\tbathrooms: record.bathrooms === null ? null : toNumber(record.bathrooms),\n\t\t\trent:\n\t\t\t\trecord.rent_amount === null\n\t\t\t\t\t? null\n\t\t\t\t\t: toNumber(record.rent_amount ?? record.rent),\n\t\t\tsquareFeet:\n\t\t\t\trecord.square_feet === null\n\t\t\t\t\t? null\n\t\t\t\t\t: toNumber(record.square_feet ?? record.squareFeet)\n\t\t}\n\t})\n}\n\nexport function mapUnitStatistics(data: unknown): UnitStatisticEntry[] {\n\tif (Array.isArray(data)) {\n\t\treturn data.map(item => {\n\t\t\tconst record = isObject(item) ? item : {}\n\t\t\treturn {\n\t\t\t\tlabel: toString(record.label ?? record.metric ?? 'Metric'),\n\t\t\t\tvalue: toNumber(record.value ?? record.count),\n\t\t\t\ttrend:\n\t\t\t\t\trecord.trend === null\n\t\t\t\t\t\t? null\n\t\t\t\t\t\t: toNumber(record.trend ?? record.delta ?? 0)\n\t\t\t}\n\t\t})\n\t}\n\n\tif (isObject(data)) {\n\t\treturn Object.entries(data).map(([key, value]) => ({\n\t\t\tlabel: toString(key),\n\t\t\tvalue: toNumber(value)\n\t\t}))\n\t}\n\n\treturn []\n}\n\nexport function mapVisitorAnalytics(data: unknown): VisitorAnalyticsResponse {\n\tif (!data) {\n\t\treturn {\n\t\t\tsummary: {\n\t\t\t\ttotalVisits: 0,\n\t\t\t\ttotalInquiries: 0,\n\t\t\t\ttotalConversions: 0,\n\t\t\t\tconversionRate: 0\n\t\t\t},\n\t\t\ttimeline: []\n\t\t}\n\t}\n\n\tconst record = isObject(data) ? data : {}\n\tconst timelineSource = Array.isArray(record.timeline)\n\t\t? record.timeline\n\t\t: Array.isArray(record.points)\n\t\t\t? record.points\n\t\t\t: Array.isArray(data)\n\t\t\t\t? (data as unknown[])\n\t\t\t\t: []\n\n\tconst timeline: VisitorAnalyticsPoint[] = timelineSource.map(item => {\n\t\tconst entry = isObject(item) ? item : {}\n\t\treturn {\n\t\t\tperiod: toString(entry.period ?? entry.date ?? entry.month ?? ''),\n\t\t\tvisits: toNumber(entry.visits ?? entry.views ?? entry.traffic),\n\t\t\tinquiries: toNumber(entry.inquiries ?? entry.leads),\n\t\t\tconversions: toNumber(\n\t\t\t\tentry.conversions ?? entry.signups ?? entry.applications\n\t\t\t)\n\t\t}\n\t})\n\n\tconst summaryRecord = isObject(record.summary) ? record.summary : record\n\n\tconst totalVisits = toNumber(\n\t\tsummaryRecord.total_visits ??\n\t\t\tsummaryRecord.visits ??\n\t\t\ttimeline.reduce((acc, point) => acc + point.visits, 0)\n\t)\n\tconst totalInquiries = toNumber(\n\t\tsummaryRecord.total_inquiries ??\n\t\t\tsummaryRecord.inquiries ??\n\t\t\ttimeline.reduce((acc, point) => acc + point.inquiries, 0)\n\t)\n\tconst totalConversions = toNumber(\n\t\tsummaryRecord.total_conversions ??\n\t\t\tsummaryRecord.conversions ??\n\t\t\ttimeline.reduce((acc, point) => acc + point.conversions, 0)\n\t)\n\tconst conversionRate =\n\t\ttotalVisits > 0\n\t\t\t? Number(((totalConversions / totalVisits) * 100).toFixed(1))\n\t\t\t: 0\n\n\treturn {\n\t\tsummary: {\n\t\t\ttotalVisits,\n\t\t\ttotalInquiries,\n\t\t\ttotalConversions,\n\t\t\tconversionRate\n\t\t},\n\t\ttimeline\n\t}\n}\n\nexport function buildPropertyPerformancePageResponse(raw: {\n\tperformance?: unknown\n\tunits?: unknown\n\tunitStats?: unknown\n\tvisitorAnalytics?: unknown\n}): PropertyPerformancePageResponse {\n\tconst performance = mapPropertyPerformance(raw.performance)\n\n\treturn {\n\t\tmetrics: computePropertySummary(performance),\n\t\tperformance,\n\t\tunits: mapPropertyUnits(raw.units),\n\t\tunitStats: mapUnitStatistics(raw.unitStats),\n\t\tvisitorAnalytics: mapVisitorAnalytics(raw.visitorAnalytics)\n\t}\n}\n"]}