{"version":3,"file":"leases.js","sourceRoot":"","sources":["leases.ts"],"names":[],"mappings":"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","sourcesContent":["// Lease validation schema for TenantFlow\nimport { z } from 'zod'\nimport { Constants } from '../types/supabase-generated.js'\nimport { requiredString } from './common.js'\n\n// Enhanced validation with Zod patterns\nconst positiveMoneyAmount = z\n\t.number()\n\t.positive({ message: 'Amount must be greater than zero' })\n\t.max(100000, { message: 'Amount exceeds maximum limit' })\n\t.refine(Number.isFinite, { message: 'Must be a finite number' })\n\nconst uuidString = z\n\t.string()\n\t.regex(\n\t\t/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,\n\t\t{ message: 'Must be a valid identifier' }\n\t)\n\nconst dateString = z\n\t.string()\n\t.refine(\n\t\t(val: string) => /^\\d{4}-\\d{2}-\\d{2}$/.test(val) || !isNaN(Date.parse(val)),\n\t\t{\n\t\t\tmessage: 'Invalid date format'\n\t\t}\n\t)\n\n// Use auto-generated Supabase enums - single source of truth\nexport const leaseStatusEnum = z.enum(\n\tConstants.public.Enums.LeaseStatus as readonly [string, ...string[]]\n)\n\nexport const leaseTypeEnum = z.enum(\n\tConstants.public.Enums.LeaseType as readonly [string, ...string[]]\n)\n\nexport const smokingPolicyEnum = z.enum(['ALLOWED', 'NOT_ALLOWED'])\n\n// Base lease object schema (without refinements) - matches Supabase Lease table exactly\nconst leaseBaseSchema = z.object({\n\tunitId: uuidString,\n\ttenantId: uuidString,\n\tstartDate: dateString,\n\tendDate: dateString.optional().nullable(), // NULL for month-to-month leases\n\t/**\n\t * Monthly rent amount in cents (integer, positive)\n\t * @example 250000 = $2,500.00/month\n\t * Consumers should convert to dollars for display (amount / 100)\n\t */\n\trentAmount: positiveMoneyAmount,\n\t// Security deposit is optional - 0 or empty is valid (some leases may not require a deposit)\n\tsecurityDeposit: positiveMoneyAmount.optional().nullable().or(z.literal(0)),\n\tterms: z.string().optional().nullable(),\n\tstatus: leaseStatusEnum.default('DRAFT' as const),\n\tpropertyId: uuidString.optional().nullable(),\n\tmonthlyRent: positiveMoneyAmount.optional().nullable()\n})\n\n// Main lease input schema (with refinements)\nexport const leaseInputSchema = leaseBaseSchema.refine(\n\t(data: { startDate: string; endDate?: string | null | undefined }) => {\n\t\ttry {\n\t\t\tconst start = new Date(data.startDate)\n\t\t\t// If endDate is null/undefined, it's a month-to-month lease - valid\n\t\t\tif (!data.endDate) return true\n\n\t\t\tconst end = new Date(data.endDate)\n\t\t\treturn !isNaN(start.getTime()) && !isNaN(end.getTime()) && end > start\n\t\t} catch {\n\t\t\treturn false\n\t\t}\n\t},\n\t{\n\t\tmessage: 'End date must be after start date (or null for month-to-month)',\n\t\tpath: ['endDate']\n\t}\n)\n\n// Lease renewal schema\nexport const leaseRenewalSchema = z.object({\n\tendDate: dateString,\n\tnewRent: positiveMoneyAmount.optional(),\n\trenewalTerms: z.string().optional()\n})\n\n// Lease termination schema\nexport const leaseTerminationSchema = z.object({\n\tterminationDate: dateString,\n\treason: requiredString,\n\tearlyTerminationFee: positiveMoneyAmount.optional(),\n\trefundableDeposit: positiveMoneyAmount.optional(),\n\tnotes: z.string().optional()\n})\n\n// Lease update schema (for partial updates)\nexport const leaseUpdateSchema = leaseBaseSchema.partial()\n\nexport type LeaseFormData = z.infer<typeof leaseInputSchema>\nexport type LeaseRenewalData = z.infer<typeof leaseRenewalSchema>\nexport type LeaseTerminationData = z.infer<typeof leaseTerminationSchema>\nexport type LeaseStatus = z.infer<typeof leaseStatusEnum>\n\n// Backend DTO compatibility aliases\nexport type CreateLeaseInput = z.infer<typeof leaseInputSchema>\nexport type UpdateLeaseInput = z.infer<typeof leaseUpdateSchema>\nexport type LeaseInput = z.infer<typeof leaseInputSchema>\nexport type LeaseUpdate = z.infer<typeof leaseUpdateSchema>\nexport type LeaseQuery = z.infer<typeof leaseInputSchema> // Add proper query schema if needed\n"]}