{"version":3,"file":"tenants.js","sourceRoot":"","sources":["tenants.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod'\nimport {\n\temailSchema,\n\tnonEmptyStringSchema,\n\tphoneSchema,\n\tuuidSchema\n} from './common.js'\n\n// Emergency contact is just a text field in the database\nexport const emergencyContactSchema = z\n\t.string()\n\t.max(500, 'Emergency contact info cannot exceed 500 characters')\n\t.optional()\n\n// Base tenant object schema - matches Supabase Tenant table exactly\nconst tenantBaseSchema = z.object({\n\temail: emailSchema,\n\tname: nonEmptyStringSchema\n\t\t.max(200, 'Name cannot exceed 200 characters')\n\t\t.optional(),\n\tfirstName: nonEmptyStringSchema\n\t\t.max(100, 'First name cannot exceed 100 characters')\n\t\t.optional(),\n\tlastName: nonEmptyStringSchema\n\t\t.max(100, 'Last name cannot exceed 100 characters')\n\t\t.optional(),\n\tphone: phoneSchema.optional(),\n\temergencyContact: emergencyContactSchema,\n\tavatarUrl: z.string().url().optional(),\n\tuserId: uuidSchema.optional()\n})\n\n// Base tenant input schema (for forms and API creation)\nexport const tenantInputSchema = tenantBaseSchema\n\n// Full tenant schema (includes server-generated fields)\nexport const tenantSchema = tenantBaseSchema.extend({\n\tid: uuidSchema,\n\tcreatedAt: z.date(),\n\tupdatedAt: z.date()\n})\n\n// Tenant update schema (partial input)\nexport const tenantUpdateSchema = tenantBaseSchema.partial()\n\n// Tenant query schema (for search/filtering)\nexport const tenantQuerySchema = z.object({\n\tsearch: z.string().optional(),\n\tuserId: uuidSchema.optional(),\n\tsortBy: z\n\t\t.enum(['name', 'firstName', 'lastName', 'email', 'createdAt'])\n\t\t.optional(),\n\tsortOrder: z.enum(['asc', 'desc']).optional().default('desc'),\n\tpage: z.coerce.number().int().positive().default(1),\n\tlimit: z.coerce.number().int().positive().max(100).default(10)\n})\n\n// Tenant statistics schema\nexport const tenantStatsSchema = z.object({\n\ttotal: z.number().nonnegative()\n})\n\n// Export types\nexport type TenantInput = z.infer<typeof tenantInputSchema>\nexport type Tenant = z.infer<typeof tenantSchema>\nexport type TenantUpdate = z.infer<typeof tenantUpdateSchema>\nexport type TenantQuery = z.infer<typeof tenantQuerySchema>\nexport type TenantStats = z.infer<typeof tenantStatsSchema>\nexport type EmergencyContact = z.infer<typeof emergencyContactSchema>\n\n// Enhanced frontend-specific form schema with better validation\nexport const tenantFormSchema = z.object({\n\temail: z\n\t\t.string()\n\t\t.min(1, 'Email is required')\n\t\t.email('Please enter a valid email address')\n\t\t.max(254, 'Email cannot exceed 254 characters'),\n\tname: z\n\t\t.string()\n\t\t.max(200, 'Name cannot exceed 200 characters')\n\t\t.optional()\n\t\t.transform(val => val?.trim() || undefined),\n\tfirstName: z\n\t\t.string()\n\t\t.min(1, 'First name is required')\n\t\t.max(100, 'First name cannot exceed 100 characters')\n\t\t.regex(\n\t\t\t/^[a-zA-Z\\s'-]+$/,\n\t\t\t'First name can only contain letters, spaces, hyphens, and apostrophes'\n\t\t)\n\t\t.optional()\n\t\t.transform(val => val?.trim() || undefined),\n\tlastName: z\n\t\t.string()\n\t\t.min(1, 'Last name is required')\n\t\t.max(100, 'Last name cannot exceed 100 characters')\n\t\t.regex(\n\t\t\t/^[a-zA-Z\\s'-]+$/,\n\t\t\t'Last name can only contain letters, spaces, hyphens, and apostrophes'\n\t\t)\n\t\t.optional()\n\t\t.transform(val => val?.trim() || undefined),\n\tphone: z\n\t\t.string()\n\t\t.optional()\n\t\t.transform(val => val?.replace(/[^\\d+()-\\s]/g, '') || undefined)\n\t\t.refine(\n\t\t\tval => !val || phoneSchema.safeParse(val).success,\n\t\t\t'Please enter a valid phone number'\n\t\t),\n\temergencyContact: z\n\t\t.string()\n\t\t.max(500, 'Emergency contact info cannot exceed 500 characters')\n\t\t.optional()\n\t\t.transform(val => val?.trim() || undefined),\n\tavatarUrl: z\n\t\t.string()\n\t\t.url('Please enter a valid URL')\n\t\t.optional()\n\t\t.transform(val => val?.trim() || undefined),\n\tuserId: z.string().uuid('User ID must be a valid UUID').optional()\n})\n\n// Enhanced validation schema for tenant creation with stricter requirements\nexport const tenantCreateFormSchema = tenantFormSchema.partial().extend({\n\temail: z\n\t\t.string()\n\t\t.min(1, 'Email is required')\n\t\t.email('Please enter a valid email address')\n\t\t.max(254, 'Email cannot exceed 254 characters'),\n\tname: z\n\t\t.string()\n\t\t.min(1, 'Name is required')\n\t\t.max(200, 'Name cannot exceed 200 characters')\n\t\t.optional(),\n\tfirstName: z\n\t\t.string()\n\t\t.max(100, 'First name cannot exceed 100 characters')\n\t\t.optional()\n\t\t.transform(val => val?.trim() || undefined),\n\tlastName: z\n\t\t.string()\n\t\t.max(100, 'Last name cannot exceed 100 characters')\n\t\t.optional()\n\t\t.transform(val => val?.trim() || undefined)\n})\n\n// Enhanced validation schema for tenant updates with optional fields\nexport const tenantUpdateFormSchema = tenantFormSchema.partial()\n\n// Utility types for better form state management\nexport type TenantFormData = z.input<typeof tenantFormSchema>\nexport type TenantFormOutput = z.output<typeof tenantFormSchema>\nexport type TenantCreateFormData = z.input<typeof tenantCreateFormSchema>\nexport type TenantUpdateFormData = z.input<typeof tenantUpdateFormSchema>\n\n// Type utilities for form validation results\nexport type TenantFormValidationResult<T = TenantFormOutput> = {\n\tsuccess: boolean\n\tdata?: T\n\terrors?: z.ZodError\n}\n\n// Enhanced error handling type\nexport type TenantFormError = {\n\tfield: keyof TenantFormData\n\tmessage: string\n\tcode?: string\n}\n\n// Validation utility functions\nexport const validateTenantForm = (\n\tdata: TenantFormData\n): TenantFormValidationResult<TenantFormOutput> => {\n\tconst result = tenantFormSchema.safeParse(data)\n\tconst validationResult: TenantFormValidationResult<TenantFormOutput> = {\n\t\tsuccess: result.success\n\t}\n\tif (result.success) {\n\t\tvalidationResult.data = result.data\n\t} else {\n\t\tvalidationResult.errors = result.error\n\t}\n\treturn validationResult\n}\n\n// Backend DTO schemas - match CreateTenantRequest/UpdateTenantRequest from backend-domain.ts\nexport const createTenantRequestSchema = z.object({\n\tfirstName: nonEmptyStringSchema.max(100).optional(),\n\tlastName: nonEmptyStringSchema.max(100).optional(),\n\temail: emailSchema,\n\tphone: phoneSchema.optional(),\n\tdateOfBirth: z.string().optional(),\n\tssn: z.string().optional(),\n\tname: nonEmptyStringSchema.max(200).optional(),\n\temergencyContact: emergencyContactSchema,\n\tavatarUrl: z.string().url().optional()\n})\n\nexport const updateTenantRequestSchema = z.object({\n\tfirstName: nonEmptyStringSchema.max(100).optional(),\n\tlastName: nonEmptyStringSchema.max(100).optional(),\n\temail: emailSchema.optional(),\n\tphone: phoneSchema.optional(),\n\tdateOfBirth: z.string().optional(),\n\tname: nonEmptyStringSchema.max(200).optional(),\n\temergencyContact: emergencyContactSchema\n})\n\nexport const validateTenantCreateForm = (\n\tdata: TenantCreateFormData\n): TenantFormValidationResult<z.output<typeof tenantCreateFormSchema>> => {\n\tconst result = tenantCreateFormSchema.safeParse(data)\n\tconst validationResult: TenantFormValidationResult<\n\t\tz.output<typeof tenantCreateFormSchema>\n\t> = {\n\t\tsuccess: result.success\n\t}\n\tif (result.success) {\n\t\tvalidationResult.data = result.data\n\t} else {\n\t\tvalidationResult.errors = result.error\n\t}\n\treturn validationResult\n}\n"]}