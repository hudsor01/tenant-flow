{"version":3,"file":"lease-generation.schemas.js","sourceRoot":"","sources":["lease-generation.schemas.ts"],"names":[],"mappings":"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","sourcesContent":["import { z } from 'zod'\n\n/**\n * Timezone-safe date validation for YYYY-MM-DD calendar dates\n * \n * Lease dates are calendar dates (not timestamps), so we parse them consistently\n * in UTC to avoid timezone-related bugs. For example:\n * - User selects \"2024-01-15\" â†’ treated as Jan 15 regardless of timezone\n * - Parsing \"2024-01-15\" as UTC midnight ensures consistent validation\n * \n * @param val - Date string in YYYY-MM-DD format\n * @returns val if valid, throws Error if invalid\n */\nexport const validateDateString = (val: unknown): unknown => {\n\tif (typeof val === 'string' && val.length > 0) {\n\t\t// Validate YYYY-MM-DD format\n\t\tif (!/^\\d{4}-\\d{2}-\\d{2}$/.test(val)) {\n\t\t\tthrow new Error('Date must be in YYYY-MM-DD format')\n\t\t}\n\t\t\n\t\t// Parse as UTC midnight for consistent validation (avoids timezone bugs)\n\t\t// This treats \"2024-01-15\" as a calendar date, not a timestamp\n\t\tconst date = new Date(`${val}T00:00:00.000Z`)\n\t\t\n\t\t// Validate it's a real date (rejects 2024-99-99, 2024-02-30, etc.)\n\t\tif (isNaN(date.getTime())) {\n\t\t\tthrow new Error('Invalid date')\n\t\t}\n\t\t\n\t\t// Additional validation: Extract parts and verify they match\n\t\t// This catches edge cases like \"2024-02-30\" which Date might auto-adjust\n\t\tconst [year, month, day] = val.split('-').map(Number)\n\t\tif (\n\t\t\tdate.getUTCFullYear() !== year ||\n\t\t\tdate.getUTCMonth() + 1 !== month ||\n\t\t\tdate.getUTCDate() !== day\n\t\t) {\n\t\t\tthrow new Error('Invalid date')\n\t\t}\n\t}\n\treturn val\n}\n\n/**\n * Lease Generation Form Schema\n * Maps to Texas Residential Lease Agreement PDF (34 sections)\n */\nexport const leaseGenerationSchema = z.object({\n\t// Section 1: Property & Parties (Page 1)\n\tagreementDate: z.preprocess(validateDateString, z.string().min(1, 'Agreement date is required')),\n\townerName: z.string().min(1, 'Property owner name is required'),\n\townerAddress: z.string().min(1, 'Property owner address is required'),\n\townerPhone: z.string().optional(),\n\ttenantName: z.string().min(1, 'Tenant name is required'),\n\tpropertyAddress: z.string().min(1, 'Property address is required'),\n\n\t// Section 2: Term (Page 1)\n\tcommencementDate: z.preprocess(validateDateString, z.string().min(1, 'Commencement date is required')),\n\tterminationDate: z.preprocess(validateDateString, z.string().min(1, 'Termination date is required')),\n\n\t// Section 3: Rent (Pages 1-2)\n\tmonthlyRent: z.number().gt(0, 'Monthly rent must be positive'),\n\trentDueDay: z.number().min(1).max(31).default(1),\n\tlateFeeAmount: z.number().min(0).optional(),\n\tlateFeeGraceDays: z.number().min(0).default(3),\n\tnsfFee: z.number().min(0).default(50),\n\n\t// Section 4: Security Deposit (Page 2)\n\tsecurityDeposit: z.number().min(0),\n\tsecurityDepositDueDays: z.number().min(0).default(30),\n\n\t// Section 5: Use of Premises (Page 2)\n\tmaxOccupants: z.number().min(1).optional(),\n\tallowedUse: z\n\t\t.string()\n\t\t.default('Residential dwelling purposes only. No business activities.'),\n\n\t// Section 8: Alterations (Pages 2-3)\n\talterationsAllowed: z.boolean().default(false),\n\talterationsRequireConsent: z.boolean().default(true),\n\n\t// Section 11: Utilities (Page 3)\n\tutilitiesIncluded: z.array(z.string()).default([]),\n\ttenantResponsibleUtilities: z.array(z.string()).default([]),\n\n\t// Section 12: Maintenance Rules (Pages 3-4)\n\tpropertyRules: z.string().optional(),\n\n\t// Section 16: Hold Over Rent (Page 5)\n\tholdOverRentMultiplier: z.number().min(1).default(1.2), // 120% of monthly rent\n\n\t// Section 18: Animals (Page 5)\n\tpetsAllowed: z.boolean().default(false),\n\tpetDeposit: z.number().min(0).default(0),\n\tpetRent: z.number().min(0).default(0),\n\n\t// Section 24: Attorneys' Fees (Page 6)\n\tprevailingPartyAttorneyFees: z.boolean().default(true),\n\n\t// Section 26: Governing Law (Page 6)\n\tgoverningState: z.string().default('TX'),\n\n\t// Section 33: Notice (Page 6)\n\tnoticeAddress: z.string().optional(),\n\tnoticeEmail: z.string().email().optional(),\n\n\t// Section 34: Lead-Based Paint (Page 7)\n\tpropertyBuiltBefore1978: z.boolean().default(false),\n\tleadPaintDisclosureProvided: z.boolean().optional(),\n\n\t// Additional metadata (required for authorization/validation)\n\tpropertyId: z.string().uuid('Invalid property ID'),\n\ttenantId: z.string().optional()\n}).refine(\n\t(data) => {\n\t\t// Validate terminationDate > commencementDate\n\t\t// Parse as UTC midnight for consistent comparison (same as validateDateString)\n\t\tconst commence = new Date(`${data.commencementDate}T00:00:00.000Z`)\n\t\tconst terminate = new Date(`${data.terminationDate}T00:00:00.000Z`)\n\n\t\t// Check both dates are valid\n\t\tif (isNaN(commence.getTime()) || isNaN(terminate.getTime())) {\n\t\t\treturn true // Let individual field validation handle invalid dates\n\t\t}\n\n\t\treturn terminate > commence\n\t},\n\t{\n\t\tmessage: 'Termination date must be after commencement date',\n\t\tpath: ['terminationDate']\n\t}\n)\n\nexport type LeaseGenerationFormData = z.infer<typeof leaseGenerationSchema>\n\n/**\n * Auto-fill schema for pre-populating form from property/tenant/unit data\n * Matches the GET /api/v1/leases/auto-fill/:propertyId/:unitId/:tenantId endpoint\n */\nexport const leaseAutoFillSchema = z.object({\n\tpropertyId: z.string().uuid('Invalid property ID'),\n\tunitId: z.string().uuid('Invalid unit ID'),\n\ttenantId: z.string().uuid('Invalid tenant ID')\n})\n\nexport type LeaseAutoFillRequest = z.infer<typeof leaseAutoFillSchema>\n"]}