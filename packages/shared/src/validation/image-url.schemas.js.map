{"version":3,"file":"image-url.schemas.js","sourceRoot":"","sources":["image-url.schemas.ts"],"names":[],"mappings":";;;AAQA,6BAAuB;AASV,QAAA,cAAc,GAAG,OAAC;KAC7B,MAAM,EAAE;KACR,MAAM,CACN,GAAG,CAAC,EAAE;IAEL,IAAI,CAAC,GAAG;QAAE,OAAO,IAAI,CAAA;IAGrB,IAAI,GAAG,CAAC,UAAU,CAAC,aAAa,CAAC,EAAE,CAAC;QACnC,OAAO,8CAA8C,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;IAChE,CAAC;IAGD,IAAI,GAAG,CAAC,QAAQ,CAAC,wCAAwC,CAAC,EAAE,CAAC;QAC5D,IAAI,CAAC;YACJ,MAAM,MAAM,GAAG,IAAI,GAAG,CAAC,GAAG,CAAC,CAAA;YAC3B,OAAO,CACN,MAAM,CAAC,QAAQ,KAAK,QAAQ;gBAC5B,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,cAAc,CAAC;gBACxC,MAAM,CAAC,QAAQ,CAAC,UAAU,CAAC,4BAA4B,CAAC,CACxD,CAAA;QACF,CAAC;QAAC,MAAM,CAAC;YACR,OAAO,KAAK,CAAA;QACb,CAAC;IACF,CAAC;IAED,OAAO,KAAK,CAAA;AACb,CAAC,EACD;IACC,OAAO,EACN,oEAAoE;CACrE,CACD;KACA,QAAQ,EAAE;KACV,QAAQ,EAAE,CAAA;AAKC,QAAA,sBAAsB,GAAG,sBAAc,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,EAAE;IACzE,OAAO,EAAE,uBAAuB;CAChC,CAAC,CAAA","sourcesContent":["/**\n * Image URL Validation\n *\n * Security: Only allow images from trusted sources\n * - Supabase Storage (our CDN)\n * - Data URLs for base64 encoded images (for upload previews)\n */\n\nimport { z } from 'zod'\n\n/**\n * Validates image URLs from trusted sources\n *\n * Allowed patterns:\n * - Supabase Storage: https://*.supabase.co/storage/v1/object/public/*\n * - Data URLs: data:image/(jpeg|jpg|png|gif|webp);base64,* (SVG excluded for XSS protection)\n */\nexport const imageUrlSchema = z\n\t.string()\n\t.refine(\n\t\turl => {\n\t\t\t// Allow empty/null\n\t\t\tif (!url) return true\n\n\t\t\t// Allow data URLs for base64 encoded images (excluding SVG for XSS protection)\n\t\t\tif (url.startsWith('data:image/')) {\n\t\t\t\treturn /^data:image\\/(jpeg|jpg|png|gif|webp);base64,/.test(url)\n\t\t\t}\n\n\t\t\t// Allow Supabase Storage URLs\n\t\t\tif (url.includes('.supabase.co/storage/v1/object/public/')) {\n\t\t\t\ttry {\n\t\t\t\t\tconst urlObj = new URL(url)\n\t\t\t\t\treturn (\n\t\t\t\t\t\turlObj.protocol === 'https:' &&\n\t\t\t\t\t\turlObj.hostname.endsWith('.supabase.co') &&\n\t\t\t\t\t\turlObj.pathname.startsWith('/storage/v1/object/public/')\n\t\t\t\t\t)\n\t\t\t\t} catch {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false\n\t\t},\n\t\t{\n\t\t\tmessage:\n\t\t\t\t'Image URL must be from Supabase Storage or a valid base64 data URL'\n\t\t}\n\t)\n\t.optional()\n\t.nullable()\n\n/**\n * Validates required image URLs\n */\nexport const requiredImageUrlSchema = imageUrlSchema.refine(url => !!url, {\n\tmessage: 'Image URL is required'\n})\n"]}