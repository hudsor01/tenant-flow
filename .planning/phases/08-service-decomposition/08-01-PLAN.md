---
phase: 08-service-decomposition
plan: 01
type: execute
subsystem: backend
---

<objective>
Decompose oversized services into focused, single-responsibility services.

Purpose: Improve maintainability by separating unrelated concerns in large service files.
Output: Focused services with clear single responsibilities, easier to test and maintain.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/TECH_DEBT.md

# Prior plan
@.planning/phases/07-reports-controller-split/07-01-SUMMARY.md

# Target files analysis:

## utility.service.ts (590 lines) - SPLIT
Contains 3 unrelated concerns:
- Search functionality (185 lines) → EXTRACT to search.service.ts
- Password validation (97 lines) → EXTRACT to password.service.ts
- User management (238 lines) → KEEP (core concern)

## pdf-generator.service.ts (604 lines) - ASSESS
Already well-structured with:
- ReactLeasePDFService (separate file)
- LeasePdfGeneratorService (separate file)
- The 604-line file is cohesive (all PDF generation)

Decision: Utility split provides more value. PDF service acceptable as-is.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract search service</name>
  <files>
    apps/backend/src/shared/services/search.service.ts
  </files>
  <action>
1. Create `shared/services/search.service.ts`:
   - Move searchByName method from UtilityService
   - Inject: SupabaseService, AppLogger
   - Import sql-safe.utils helpers

2. Include all search-related logic:
   - searchByName method
   - Result transformation
   - Relevance sorting
  </action>
  <verify>File created with searchByName method</verify>
  <done>Search service extracted</done>
</task>

<task type="auto">
  <name>Task 2: Extract password service</name>
  <files>
    apps/backend/src/shared/services/password.service.ts
  </files>
  <action>
1. Create `shared/services/password.service.ts`:
   - Move validatePasswordStrength method from UtilityService
   - Move PasswordValidationResult interface
   - Inject: AppLogger

2. Pure validation logic, no database dependencies
  </action>
  <verify>File created with validatePasswordStrength method</verify>
  <done>Password service extracted</done>
</task>

<task type="auto">
  <name>Task 3: Update utility.service.ts and services.module.ts</name>
  <files>
    apps/backend/src/shared/services/utility.service.ts
    apps/backend/src/shared/services/services.module.ts
  </files>
  <action>
1. Update utility.service.ts:
   - Remove searchByName method (moved to SearchService)
   - Remove validatePasswordStrength method (moved to PasswordService)
   - Remove PasswordValidationResult interface (moved to PasswordService)
   - Keep user management methods only

2. Update services.module.ts:
   - Add SearchService, PasswordService to providers/exports

3. Run typecheck to find consumers
  </action>
  <verify>utility.service.ts reduced to ~250 lines</verify>
  <done>Utility service cleaned up</done>
</task>

<task type="auto">
  <name>Task 4: Update consumers and verify</name>
  <files>
    (consumers of UtilityService.searchByName and validatePasswordStrength)
  </files>
  <action>
1. Find and update consumers:
   - Search for `utilityService.searchByName` → use SearchService
   - Search for `utilityService.validatePasswordStrength` → use PasswordService

2. Run typecheck and tests:
   ```bash
   pnpm --filter @repo/backend typecheck
   pnpm --filter @repo/backend test:unit
   ```
  </action>
  <verify>
    - `pnpm --filter @repo/backend typecheck` passes
    - `pnpm --filter @repo/backend test:unit` passes
    - utility.service.ts reduced to <300 lines
  </verify>
  <done>All consumers updated, tests pass</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] shared/services/search.service.ts exists
- [ ] shared/services/password.service.ts exists
- [ ] utility.service.ts reduced to <300 lines (user management only)
- [ ] services.module.ts exports SearchService, PasswordService
- [ ] All consumers updated to use new services
- [ ] `pnpm --filter @repo/backend typecheck` passes
- [ ] `pnpm --filter @repo/backend test:unit` passes
</verification>

<success_criteria>
- utility.service.ts reduced from 590 to <300 lines
- 2 new focused services created (search, password)
- Clear single responsibility for each service
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/08-service-decomposition/08-01-SUMMARY.md` using summary template.
</output>
