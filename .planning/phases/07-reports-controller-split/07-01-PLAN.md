---
phase: 07-reports-controller-split
plan: 01
type: execute
subsystem: backend
---

<objective>
Split reports.controller.ts (703 lines) into focused controllers by operation type.

Purpose: Improve maintainability by grouping related report endpoints into separate controllers.
Output: 3 new controllers (export, generation, analytics) with reports.controller.ts reduced to data endpoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/TECH_DEBT.md

# Prior plan
@.planning/phases/06-stripe-controller-split/06-01-SUMMARY.md

# Current controller structure (703 lines)
@apps/backend/src/modules/reports/reports.controller.ts

Sections identified:
- Export endpoints (excel, csv, pdf) - 3 endpoints → EXTRACT
- Generate endpoints (executive, financial, property, lease, maintenance, tax) - 6 endpoints → EXTRACT
- Analytics endpoints (revenue, payments, occupancy) - 3 endpoints → EXTRACT
- Report Data endpoints (financial, properties, tenants, maintenance) - 4 endpoints → KEEP
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract report export controller</name>
  <files>
    apps/backend/src/modules/reports/report-export.controller.ts
  </files>
  <action>
1. Create `reports/report-export.controller.ts`:
   - Extract: POST /export/excel
   - Extract: POST /export/csv
   - Extract: POST /export/pdf
   - Use @Controller('reports') to maintain route paths
   - Include all Swagger decorators
   - Inject ReportsService, AppLogger

2. These are file export operations that generate downloadable files
  </action>
  <verify>File created with 3 endpoints</verify>
  <done>Report export controller extracted</done>
</task>

<task type="auto">
  <name>Task 2: Extract report generation controller</name>
  <files>
    apps/backend/src/modules/reports/report-generation.controller.ts
  </files>
  <action>
1. Create `reports/report-generation.controller.ts`:
   - Extract: POST /generate/executive-monthly
   - Extract: POST /generate/financial-performance
   - Extract: POST /generate/property-portfolio
   - Extract: POST /generate/lease-portfolio
   - Extract: POST /generate/maintenance-operations
   - Extract: POST /generate/tax-preparation
   - Use @Controller('reports') to maintain route paths

2. These are complex report generation operations
  </action>
  <verify>File created with 6 endpoints</verify>
  <done>Report generation controller extracted</done>
</task>

<task type="auto">
  <name>Task 3: Extract report analytics controller</name>
  <files>
    apps/backend/src/modules/reports/report-analytics.controller.ts
  </files>
  <action>
1. Create `reports/report-analytics.controller.ts`:
   - Extract: GET /analytics/revenue/monthly
   - Extract: GET /analytics/payments
   - Extract: GET /analytics/occupancy
   - Use @Controller('reports') to maintain route paths

2. These are analytics data retrieval operations
  </action>
  <verify>File created with 3 endpoints</verify>
  <done>Report analytics controller extracted</done>
</task>

<task type="auto">
  <name>Task 4: Update reports.module.ts and cleanup</name>
  <files>
    apps/backend/src/modules/reports/reports.module.ts
    apps/backend/src/modules/reports/reports.controller.ts
  </files>
  <action>
1. Update reports.module.ts:
   - Add ReportExportController, ReportGenerationController, ReportAnalyticsController
   - Keep ReportsController for data endpoints

2. Clean up reports.controller.ts:
   - Remove extracted endpoint methods
   - Keep only Report Data Operations section (financial, properties, tenants, maintenance)
   - Update file header comment

3. Run typecheck and tests:
   ```bash
   pnpm --filter @repo/backend typecheck
   pnpm --filter @repo/backend test:unit
   ```
  </action>
  <verify>
    - `pnpm --filter @repo/backend typecheck` passes
    - `pnpm --filter @repo/backend test:unit` passes
    - reports.controller.ts reduced to <250 lines
  </verify>
  <done>Module updated, all controllers integrated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] reports/report-export.controller.ts exists (3 endpoints)
- [ ] reports/report-generation.controller.ts exists (6 endpoints)
- [ ] reports/report-analytics.controller.ts exists (3 endpoints)
- [ ] reports.controller.ts reduced to ~200 lines (data endpoints only)
- [ ] reports.module.ts registers all controllers
- [ ] `pnpm --filter @repo/backend typecheck` passes
- [ ] `pnpm --filter @repo/backend test:unit` passes
</verification>

<success_criteria>
- reports.controller.ts reduced from 703 to <250 lines
- 3 new focused controllers created
- All endpoints maintain same route paths
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/07-reports-controller-split/07-01-SUMMARY.md` using summary template.
</output>
