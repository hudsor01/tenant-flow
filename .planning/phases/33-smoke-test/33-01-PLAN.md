---
phase: 33-smoke-test
plan: 01
type: execute
---

<objective>
Run the full automated E2E test suite (owner + tenant + smoke projects) and document all failures in a findings report.

Purpose: Establish an objective baseline of what works and what's broken before the targeted Phase 34-37 fixes. The report feeds directly into Phase 33-02 manual verification and the ISSUES.md backlog.
Output: `.planning/phases/33-smoke-test/SMOKE-TEST-RESULTS.md` with pass/fail summary and full list of failures.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/e2e-tests/playwright.config.ts
@apps/e2e-tests/tests/smoke/critical-paths.smoke.spec.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run all E2E test projects and capture output</name>
  <files>apps/e2e-tests/test-results/smoke-run.txt, apps/e2e-tests/test-results/owner-run.txt, apps/e2e-tests/test-results/tenant-run.txt</files>
  <action>
  Playwright auto-starts frontend (port 3050) and backend (port 4650) via its webServer config — no manual server startup needed.

  Run three test suites in sequence and save output. It is EXPECTED that tests fail — we are collecting data, not fixing issues here.

  ```bash
  cd /Users/richard/Developer/tenant-flow/apps/e2e-tests
  mkdir -p test-results

  # 1. Run smoke tests (fast, ~30s)
  pnpm exec playwright test --project=chromium tests/smoke/ --reporter=list 2>&1 | tee test-results/smoke-run.txt || true

  # 2. Run all owner tests (includes auto-run of setup-owner dependency)
  pnpm exec playwright test --project=owner --reporter=list 2>&1 | tee test-results/owner-run.txt || true

  # 3. Run all tenant tests (auto-runs: setup-owner → setup-invite-tenant → setup-tenant → tenant)
  pnpm exec playwright test --project=tenant --reporter=list 2>&1 | tee test-results/tenant-run.txt || true
  ```

  If any setup project fails independently, run setup chain manually first:
  ```bash
  pnpm exec playwright test --project=setup-owner --reporter=list 2>&1 | tee test-results/setup-owner-run.txt || true
  pnpm exec playwright test --project=setup-invite-tenant --reporter=list 2>&1 | tee test-results/setup-invite-run.txt || true
  pnpm exec playwright test --project=setup-tenant --reporter=list 2>&1 | tee test-results/setup-tenant-run.txt || true
  ```

  Use `|| true` so the bash pipeline continues even when tests fail.
  </action>
  <verify>
  ```bash
  ls /Users/richard/Developer/tenant-flow/apps/e2e-tests/test-results/*.txt
  ```
  All three (or five, if setup was needed) result files exist and are non-empty.
  </verify>
  <done>Three output files exist in test-results/ with test run output. Files may contain failures — that is expected and correct.</done>
</task>

<task type="auto">
  <name>Task 2: Parse results and write SMOKE-TEST-RESULTS.md</name>
  <files>.planning/phases/33-smoke-test/SMOKE-TEST-RESULTS.md</files>
  <action>
  Read the output files from Task 1. Count passed/failed/skipped tests. Extract the names of all failed tests and a brief error summary for each.

  Write `.planning/phases/33-smoke-test/SMOKE-TEST-RESULTS.md` with this exact structure:

  ```markdown
  # Phase 33 Smoke Test Results

  **Date:** [today's date]
  **Environment:** Local (http://localhost:3050 / http://localhost:4650)

  ## Automated Test Summary

  | Suite | Passed | Failed | Skipped | Total |
  |-------|--------|--------|---------|-------|
  | Smoke (chromium) | X | X | X | X |
  | Owner | X | X | X | X |
  | Tenant | X | X | X | X |
  | **Total** | **X** | **X** | **X** | **X** |

  ## Failed Tests

  ### Smoke Tests
  - [ ] `[test file > test name]`: [one-line error summary]
  *(or "All passing" if no failures)*

  ### Owner Tests
  - [ ] `[test file > test name]`: [one-line error summary]

  ### Tenant Tests
  - [ ] `[test file > test name]`: [one-line error summary]

  ## Manual Verification

  *To be added in Plan 33-02.*

  ## Known Gaps (from pre-smoke gap analysis)

  These were identified before the smoke test and are confirmed targets for Phase 34-37:

  - [ ] **Stripe Connect CTA missing**: Owner has no visible UI to initiate Connect onboarding → Phase 34
  - [ ] **Subscription enforcement**: Free tier users can access Pro features → Phase 35
  - [ ] **Tenant rent payment**: End-to-end rent payment flow incomplete → Phase 34/36
  - [ ] **Financial pages**: Expenses/payouts pages may show empty/placeholder data → Phase 37
  ```

  Populate the summary table and failed tests sections from the actual test output. Be precise with test names.
  </action>
  <verify>
  ```bash
  cat /Users/richard/Developer/tenant-flow/.planning/phases/33-smoke-test/SMOKE-TEST-RESULTS.md
  ```
  File exists, has the summary table with real numbers, and lists any failed tests by name.
  </verify>
  <done>SMOKE-TEST-RESULTS.md exists with accurate pass/fail counts and named list of all failures.</done>
</task>

</tasks>

<verification>
Before declaring this plan complete:
- [ ] Three test output files exist in `apps/e2e-tests/test-results/`
- [ ] `SMOKE-TEST-RESULTS.md` exists in `.planning/phases/33-smoke-test/`
- [ ] Summary table has real numbers (not X placeholders)
- [ ] All failed test names are listed
</verification>

<success_criteria>
- Automated E2E runs completed for all three projects (pass or fail)
- SMOKE-TEST-RESULTS.md documents the baseline state
- Failed tests are named and categorized
</success_criteria>

<output>
After completion, create `.planning/phases/33-smoke-test/33-01-SUMMARY.md`:

---
phase: 33-smoke-test
plan: 01
subsystem: testing
provides: smoke-test-baseline
affects: [33-02]
key-files:
  - .planning/phases/33-smoke-test/SMOKE-TEST-RESULTS.md
  - apps/e2e-tests/test-results/
---

# Phase 33 Plan 01 Summary: Automated E2E Test Run

**[Headline: X/Y tests passing across owner and tenant suites]**

## Accomplishments

- Ran [N] total E2E tests across smoke, owner, and tenant projects
- [X] tests passing, [Y] failing
- SMOKE-TEST-RESULTS.md created with baseline state

## Files Created/Modified

- `.planning/phases/33-smoke-test/SMOKE-TEST-RESULTS.md` - Test run findings
- `apps/e2e-tests/test-results/*.txt` - Raw test output files

## Decisions Made

None — observation only.

## Issues Encountered

[Any issues running the tests themselves, e.g., setup failures, port conflicts]

## Next Step

Ready for 33-02-PLAN.md (manual flow verification + issue triage).
</output>
