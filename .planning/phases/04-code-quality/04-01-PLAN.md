---
phase: 04-code-quality
plan: 01
type: execute
subsystem: backend
---

<objective>
Delete dead code and consolidate duplicate services.

Purpose: Remove confusion from unused code and duplicate service names that make the codebase harder to navigate.
Output: Cleaner codebase with no dead services and unique service names.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONCERNS.md

# Prior phase summary
@.planning/phases/03-test-coverage/03-03-SUMMARY.md

**Dead services identified:**
- `apps/backend/src/modules/dashboard/services/property-stats.service.ts` - Not imported anywhere
- `apps/backend/src/modules/notifications/services/notification-formatter.service.ts` - Not imported anywhere

**Duplicate service names identified:**
- tenant-stats.service.ts exists in BOTH:
  - `apps/backend/src/modules/tenants/tenant-stats.service.ts`
  - `apps/backend/src/modules/dashboard/services/tenant-stats.service.ts`
- metrics.service.ts exists in MULTIPLE places:
  - `apps/backend/src/health/metrics.service.ts`
  - `apps/backend/src/modules/metrics/metrics.service.ts`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete dead services</name>
  <files>
    apps/backend/src/modules/dashboard/services/property-stats.service.ts
    apps/backend/src/modules/notifications/services/notification-formatter.service.ts
  </files>
  <action>
1. Verify property-stats.service.ts is not imported anywhere:
   - Search: `rg -l "PropertyStatsService|property-stats" apps/backend/src`
   - Should only return the file itself
   - If imported elsewhere, DO NOT delete - document in summary

2. Verify notification-formatter.service.ts is not imported anywhere:
   - Search: `rg -l "NotificationFormatterService|notification-formatter" apps/backend/src`
   - Should return nothing
   - If imported elsewhere, DO NOT delete - document in summary

3. Delete verified dead files:
   - `rm apps/backend/src/modules/dashboard/services/property-stats.service.ts`
   - `rm apps/backend/src/modules/notifications/services/notification-formatter.service.ts`

4. Remove from any module providers arrays if referenced (search for class name in *.module.ts files)
  </action>
  <verify>
    - `rg "PropertyStatsService|NotificationFormatterService" apps/backend/src` returns nothing
    - `pnpm --filter @repo/backend typecheck` passes
  </verify>
  <done>Dead services deleted, no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 2: Consolidate duplicate tenant-stats services</name>
  <files>
    apps/backend/src/modules/tenants/tenant-stats.service.ts
    apps/backend/src/modules/dashboard/services/tenant-stats.service.ts
  </files>
  <action>
1. Compare both files to understand their purposes:
   - Read both tenant-stats.service.ts files
   - Identify which is more complete/actively used
   - Check imports to see which is referenced where

2. Decision criteria:
   - If dashboard/tenant-stats is for dashboard-specific stats → rename to `dashboard-tenant-stats.service.ts`
   - If tenants/tenant-stats is the canonical one → remove dashboard version if duplicate

3. Rename the dashboard version to avoid collision:
   - Rename: `tenant-stats.service.ts` → `dashboard-tenant-stats.service.ts`
   - Update class name: `TenantStatsService` → `DashboardTenantStatsService`
   - Update all imports referencing this file

4. Update module registrations in dashboard.module.ts
  </action>
  <verify>
    - `rg -l "TenantStatsService" apps/backend/src` shows no ambiguous imports
    - `pnpm --filter @repo/backend typecheck` passes
  </verify>
  <done>No duplicate tenant-stats service names, clear ownership</done>
</task>

<task type="auto">
  <name>Task 3: Consolidate duplicate metrics services</name>
  <files>
    apps/backend/src/health/metrics.service.ts
    apps/backend/src/modules/metrics/metrics.service.ts
    apps/backend/src/modules/observability/metrics.controller.ts
  </files>
  <action>
1. Analyze the metrics landscape:
   - `health/metrics.service.ts` - likely health check metrics
   - `modules/metrics/metrics.service.ts` - likely Prometheus metrics
   - `modules/observability/metrics.controller.ts` - observability endpoint

2. Rename for clarity:
   - `health/metrics.service.ts` → `health-metrics.service.ts` (class: HealthMetricsService)
   - `modules/metrics/metrics.service.ts` → keep as-is (canonical Prometheus metrics)
   - If observability duplicates metrics/, consolidate into one module

3. Update all imports and module registrations

4. If modules/observability/ only has metrics.controller.ts, consider:
   - Moving controller to modules/metrics/
   - Deleting empty observability module
  </action>
  <verify>
    - `rg -l "MetricsService" apps/backend/src` shows unambiguous references
    - `pnpm --filter @repo/backend typecheck` passes
  </verify>
  <done>Metrics services have unique names, no confusion</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm --filter @repo/backend typecheck` passes
- [ ] `pnpm --filter @repo/backend test:unit` passes
- [ ] No duplicate service class names
- [ ] Dead code removed
</verification>

<success_criteria>
- Dead services deleted (property-stats, notification-formatter)
- tenant-stats services have unique names
- metrics services have unique names
- No TypeScript errors
- No test failures
</success_criteria>

<output>
After completion, create `.planning/phases/04-code-quality/04-01-SUMMARY.md` using summary template.
</output>
