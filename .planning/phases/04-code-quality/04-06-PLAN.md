---
phase: 04-code-quality
plan: 06
type: execute
subsystem: documentation
---

<objective>
Document remaining technical debt and create backlog for future milestones.

Purpose: Capture code quality items not addressed in Phase 4 for future planning.
Output: TECH_DEBT.md in .planning/ with prioritized backlog items.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan
@.planning/phases/04-code-quality/04-05-SUMMARY.md

# Health report reference
@CODEBASE_HEALTH_REPORT.md (Section 2: Code Quality)

# Files still >500 lines after 04-05
- pdf-generator.service.ts (604 lines)
- utility.service.ts (590 lines)
- late-fees.service.ts (539 lines)
- subscription-query.service.ts (534 lines)
- payment-analytics.service.ts (526 lines)
- financial-report.service.ts (511 lines)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit remaining large files</name>
  <files>
    .planning/TECH_DEBT.md
  </files>
  <action>
1. For each remaining large file, document:
   - Current line count
   - Method count and responsibilities
   - Recommended decomposition strategy (if any)
   - Priority (high/medium/low) based on change frequency

2. Check remaining items from CODEBASE_HEALTH_REPORT.md Section 2:
   - Any dead code not addressed in 04-01
   - Any duplicate patterns not consolidated
   - Architecture concerns

3. List StripeModule items for future optimization:
   - After 04-02, 04-03, 04-04: what's the final size?
   - Any further splitting recommended?
  </action>
  <verify>All large files assessed and documented</verify>
  <done>Technical debt audit complete</done>
</task>

<task type="auto">
  <name>Task 2: Create TECH_DEBT.md</name>
  <files>
    .planning/TECH_DEBT.md
  </files>
  <action>
Create `.planning/TECH_DEBT.md` with structure:

```markdown
# Technical Debt Backlog

## Overview
Items deferred from Phase 4: Code Quality for future milestones.

## Large Files (>500 lines)

### High Priority
[Files with frequent changes or high complexity]

### Medium Priority
[Files that work but are harder to maintain]

### Low Priority
[Stable files that rarely change]

## Code Quality Items

### Architecture
- [Any structural concerns]

### Patterns
- [Inconsistent patterns to standardize]

### Testing
- [Areas needing more test coverage]

## Recommendations
- [Suggested future milestone scope]
```
  </action>
  <verify>TECH_DEBT.md created with all items</verify>
  <done>Technical debt backlog documented</done>
</task>

<task type="auto">
  <name>Task 3: Verify Phase 4 completion</name>
  <files>
    apps/backend/src/modules/billing/stripe.module.ts
  </files>
  <action>
1. Final verification of Phase 4 deliverables:
   - 04-01: Dead code removed, duplicates consolidated
   - 04-02: WebhooksModule extracted
   - 04-03: ConnectModule extracted
   - 04-04: SubscriptionsModule extracted
   - 04-05: Top 3 large files refactored

2. Measure final stripe.module.ts:
   - Count remaining providers
   - Count remaining controllers
   - Line count

3. Run full validation:
   - `pnpm --filter @repo/backend typecheck`
   - `pnpm --filter @repo/backend test:unit`
  </action>
  <verify>
    - All Phase 4 plans executed successfully
    - All tests pass
    - TECH_DEBT.md complete
  </verify>
  <done>Phase 4 verified complete</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `.planning/TECH_DEBT.md` exists with all deferred items
- [ ] All remaining large files documented with recommendations
- [ ] StripeModule final state documented
- [ ] `pnpm --filter @repo/backend typecheck` passes
- [ ] `pnpm --filter @repo/backend test:unit` passes
</verification>

<success_criteria>
- Technical debt backlog documented
- Phase 4 completion verified
- Clear roadmap for future code quality work
</success_criteria>

<output>
After completion, create `.planning/phases/04-code-quality/04-06-SUMMARY.md` using summary template.
</output>
