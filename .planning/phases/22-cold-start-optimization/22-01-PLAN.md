---
phase: 22-cold-start-optimization
plan: 01
type: execute
---

<objective>
Audit cold start and runtime performance characteristics of the NestJS backend, measure baselines, and document optimization recommendations.

Purpose: Understand current performance state and identify concrete optimization opportunities for Railway deployments.
Output: Performance baseline measurements, lazy loading candidates identified, ADR with recommendations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-cold-start-optimization/22-CONTEXT.md
@.planning/phases/22-cold-start-optimization/RESEARCH.md
@.planning/phases/21-module-architecture/21-01-SUMMARY.md
@.planning/adr/0007-module-architecture.md

**Tech available from prior phases:**
- Prometheus metrics infrastructure (Phase 18)
- N+1 detection (Phase 19)
- API response standards (Phase 20)
- Module size inventory (Phase 21)

**Key files:**
- `apps/backend/src/main.ts` - Bootstrap with startup timing
- `apps/backend/src/app.module.ts` - Module imports
- `apps/backend/src/database/supabase.module.ts` - Database client
- `apps/backend/src/modules/pdf/pdf.module.ts` - Heavy module candidate
- `apps/backend/src/modules/docuseal/docuseal.module.ts` - External integration
- `apps/backend/src/modules/stripe-sync/stripe-sync.module.ts` - Background job module

**Constraining decisions:**
- Phase 21: Billing module (14k) identified as god module with forwardRef issues
- Phase 18: Supabase JS client uses REST API, not raw PostgreSQL
- This is a [RESEARCH] phase - output is documentation and recommendations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Measure Current Startup Time</name>
  <files>apps/backend/src/main.ts</files>
  <action>
Run the backend locally and capture the startup time from the logs.
Check the existing startup logging in main.ts that outputs `STARTUP: Completed in Xs`.
Run `pnpm --filter @repo/backend dev` and capture the startup time.
Document the baseline measurement.
  </action>
  <verify>Startup time captured from logs (e.g., "STARTUP: Completed in 2.34s")</verify>
  <done>Baseline startup time documented with timestamp</done>
</task>

<task type="auto">
  <name>Task 2: Audit Lazy Loading Candidates</name>
  <files>apps/backend/src/app.module.ts, apps/backend/src/modules/pdf/*.ts, apps/backend/src/modules/docuseal/*.ts, apps/backend/src/modules/stripe-sync/*.ts</files>
  <action>
Based on Phase 21 module inventory and RESEARCH.md findings, audit modules for lazy loading suitability.

**Criteria from RESEARCH.md:**
- Controllers CANNOT be lazy loaded (NestJS limitation)
- Good candidates: Background job modules, rarely-used integrations, heavy computation modules

**Modules to assess:**
1. PDF module (8.6k lines) - Check if has controllers or just services
2. DocuSeal module - External integration, assess usage frequency
3. Stripe-Sync module - Background job, assess if request-path critical

For each module, determine:
- Has controllers? (blocks lazy loading)
- On critical request path? (blocks lazy loading)
- Potential startup savings
  </action>
  <verify>Each candidate module assessed with lazy-loadable: yes/no verdict</verify>
  <done>All 3 candidate modules assessed with clear recommendations</done>
</task>

<task type="auto">
  <name>Task 3: Create Performance ADR</name>
  <files>.planning/adr/0008-cold-start-optimization.md</files>
  <action>
Create ADR documenting performance findings and recommendations.

Structure:
1. **Context:** Current startup time baseline, Railway deployment characteristics
2. **Status:** Proposed (recommendations for future implementation)
3. **Decision:** What optimizations to pursue
4. **Recommendations:**
   - Lazy loading: Which modules, expected impact
   - Connection pooling: Supabase Supavisor configuration (from RESEARCH.md)
   - Module import order: Heavy modules last
5. **Consequences:** Benefits, implementation effort, risks

Reference RESEARCH.md findings for library-specific guidance (LazyModuleLoader from @nestjs/core, Supavisor port 6543).
  </action>
  <verify>File exists at .planning/adr/0008-cold-start-optimization.md with all sections</verify>
  <done>ADR created with context, status, decision, recommendations, consequences</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Baseline startup time documented
- [ ] All 3 lazy loading candidates assessed
- [ ] ADR-0008 created with recommendations
- [ ] No code changes (research phase)
</verification>

<success_criteria>
- All tasks completed
- Startup baseline measured
- Lazy loading candidates assessed
- ADR-0008 provides actionable recommendations
- Documentation suitable for future implementation phases
</success_criteria>

<output>
After completion, create `.planning/phases/22-cold-start-optimization/22-01-SUMMARY.md`:

# Phase 22 Plan 01: Cold Start Performance Audit Summary

**[Substantive one-liner about findings]**

## Performance
- Duration, timestamps, tasks

## Accomplishments
- Startup baseline: Xs
- Lazy loading candidates: N eligible
- ADR-0008 created

## Task Commits
1. Task 1 - No commit (measurement)
2. Task 2 - No commit (audit)
3. Task 3 - `hash` (docs)

## Key Findings
- Startup time: Xs
- Lazy loading candidates table
- Top recommendations

## Decisions Made
- Table of decisions with rationale

## Issues Encountered
- Any issues or "None"

## Next Phase Readiness
- Phase 22 complete
- Ready for Phase 23 (Documentation & Best Practices Guide)

---
*Phase: 22-cold-start-optimization*
*Completed: YYYY-MM-DD*
</output>
