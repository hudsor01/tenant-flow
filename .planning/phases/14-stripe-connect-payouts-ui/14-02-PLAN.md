---
phase: 14-stripe-connect-payouts-ui
plan: 02
type: execute
domain: stripe-frontend
---

<objective>
Enhance the payouts dashboard with payout details modal, transfer breakdown, and export functionality.

Purpose: Give owners detailed visibility into their payouts and rent payments received.
Output: Payout details modal, transfer details, and CSV export.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-stripe-connect-payouts-ui/14-CONTEXT.md

**Prior summaries:**
@.planning/phases/14-stripe-connect-payouts-ui/14-01-SUMMARY.md

**Key source files:**
@apps/frontend/src/app/(owner)/financials/payouts/page.tsx
@apps/frontend/src/hooks/api/use-stripe-connect.ts

**Backend endpoints:**
- GET /api/v1/stripe/connect/payouts/:id - Payout details
- GET /api/v1/stripe/connect/transfers - List rent transfers

**Constraining decisions:**
- Reuse existing hooks and endpoints
- Enhance existing payouts page (don't create new)
- Keep mobile responsiveness
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create payout details modal</name>
  <files>
    apps/frontend/src/components/connect/payout-details-modal.tsx
  </files>
  <action>
    Create a modal showing detailed breakdown of a single payout.

    **PayoutDetailsModal component:**
    Props: payoutId, open, onOpenChange

    **Display:**
    - Payout amount (large, prominent)
    - Status badge (paid, pending, in_transit, failed)
    - Arrival date and method
    - Bank account last 4 digits
    - Creation date
    - Fee breakdown (if available)
    - Failure reason (if failed)

    **Transfer line items section:**
    - List rent payments included in this payout
    - Each shows: amount, tenant name, date, lease reference
    - "No transfers found" if empty

    Use Dialog, Badge, Separator from shadcn/ui.
    Fetch payout details using existing hook or new query.
  </action>
  <verify>
    Modal opens with payout data
    All fields display correctly
    Loading state while fetching
    Error handling for failed fetch
  </verify>
  <done>
    Payout details modal shows full breakdown
    Transfer line items listed
    All states handled
  </done>
</task>

<task type="auto">
  <name>Task 2: Add transfer details to payouts page</name>
  <files>
    apps/frontend/src/app/(owner)/financials/payouts/page.tsx
  </files>
  <action>
    Enhance the rent payments section with more details and filtering.

    **Enhancements:**
    - Add tenant name to transfer rows (from metadata)
    - Add property/unit reference
    - Add payment method icon (card vs bank)
    - Make rows clickable to show detail popover
    - Add date range filter
    - Add status filter dropdown

    **Transfer detail popover:**
    - Full amount breakdown
    - Stripe transfer ID
    - Processing date
    - Link to tenant profile (if applicable)

    **Filtering:**
    - Date picker for range selection
    - Status dropdown (all, succeeded, pending, failed)

    Enhance existing table, don't replace.
    Use nuqs for URL state management if filters complex.
  </action>
  <verify>
    Transfer rows show enhanced data
    Filters work correctly
    Detail popover displays
    Page performance acceptable
  </verify>
  <done>
    Transfers show tenant and property info
    Filtering works for date and status
    Detail views accessible
  </done>
</task>

<task type="auto">
  <name>Task 3: Add CSV export functionality</name>
  <files>
    apps/frontend/src/app/(owner)/financials/payouts/page.tsx,
    apps/frontend/src/lib/export-utils.ts
  </files>
  <action>
    Implement CSV export for payouts and transfers.

    **Export utility (export-utils.ts):**
    - Generic function to convert array of objects to CSV
    - Handle special characters and escaping
    - Support custom column mapping
    - Trigger browser download

    **Payouts export:**
    - Export button in payouts section header
    - Columns: Date, Amount, Status, Arrival Date, Method
    - Filename: payouts-{date}.csv

    **Transfers export:**
    - Export button in transfers section header
    - Columns: Date, Amount, Tenant, Property, Unit, Status
    - Filename: rent-payments-{date}.csv

    Use Blob and URL.createObjectURL for download.
    Add loading state during export.
  </action>
  <verify>
    Export buttons appear in headers
    CSV downloads correctly
    Data is properly formatted
    Special characters escaped
  </verify>
  <done>
    Payouts exportable to CSV
    Transfers exportable to CSV
    Downloads work correctly
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Enhanced payouts dashboard with details and export</what-built>
  <how-to-verify>
    1. Run: pnpm --filter @repo/frontend dev
    2. Visit: http://localhost:3050/financials/payouts
    3. Click: A payout row to open details modal
    4. Verify: Modal shows payout breakdown and transfers
    5. Check: Transfer rows show tenant/property info
    6. Test: Date and status filters
    7. Click: Export button for payouts
    8. Verify: CSV downloads with correct data
    9. Click: Export button for transfers
    10. Verify: CSV downloads with correct data
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pnpm typecheck passes
- [ ] pnpm lint passes
- [ ] Payout details modal shows all information
- [ ] Transfer rows display tenant/property info
- [ ] Filters work correctly
- [ ] CSV export produces valid files
- [ ] Mobile responsive
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Owners can view detailed payout breakdowns
- CSV export functional
- Phase 14 complete
</success_criteria>

<output>
After completion, create `.planning/phases/14-stripe-connect-payouts-ui/14-02-SUMMARY.md`

**Phase 14 Complete:** Connect account status and enhanced payouts dashboard implemented.
</output>
