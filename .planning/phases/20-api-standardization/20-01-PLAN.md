# Phase 20, Plan 01: API Response Standards Audit & Documentation

---
phase: 20-api-standardization
plan: 01
type: standard
domain: backend
---

<objective>
Audit API response patterns, document standards in ADR, and identify inconsistencies for future resolution.

**Key Research Finding:** The codebase has comprehensive request validation via Zod + global pipe. This plan focuses on response standardization documentation, not code changes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
## Prior Phase Context

@.planning/phases/20-api-standardization/20-CONTEXT.md
@.planning/phases/19-query-performance-rpc/19-01-SUMMARY.md
@.planning/adr/0004-supabase-client-patterns.md
@.planning/adr/0005-rpc-usage-patterns.md

## Relevant Source Files

@apps/backend/src/main.ts
@apps/backend/src/shared/filters/database-exception.filter.ts
@packages/shared/src/validation/common.ts

## Key Facts

**Tech stack available:** Zod 4, nestjs-zod, ZodValidationPipe, Swagger/OpenAPI

**Established patterns:**
- Request validation via `createZodDto()` + global `ZodValidationPipe`
- Error handling via `DatabaseExceptionFilter`
- Swagger decorators for documentation

**Constraining decisions:**
- Phase 18: Admin client for system ops, user client for authenticated
- Phase 19: RPCs for atomic operations, direct queries for CRUD
- CLAUDE.md: Use NestJS built-in exceptions only

**Current infrastructure:**
- 33 DTOs using Zod validation
- 22 shared validation schema files
- Global exception filter for database errors
</context>

<tasks>

## Task 1: Audit API Response Patterns

**Objective:** Catalog all response formats used across controllers to understand variance.

**Actions:**
1. Sample 8-10 controllers across different modules (properties, tenants, billing, analytics, etc.)
2. For each, document:
   - List endpoint response format (wrapped vs raw array)
   - Detail endpoint response format (wrapped vs raw object)
   - Create/Update response format
   - Error response format
3. Identify common patterns vs outliers
4. Note any response DTOs if they exist

**Verification:**
- Document with counts: X controllers use pattern A, Y use pattern B
- List any response type definitions found

**Done when:**
- Response patterns catalogued with frequency counts
- Common patterns vs exceptions identified

---

## Task 2: Create API Standards ADR

**Objective:** Document standard API response/error patterns for team reference.

**Actions:**
1. Create `.planning/adr/0006-api-response-standards.md`
2. Document:
   - Standard success response format for lists (with pagination)
   - Standard success response format for single items
   - Standard error response format
   - When to use which format
   - Existing Swagger patterns to maintain
3. Include code snippets showing correct patterns
4. Reference error codes from `@repo/shared/constants/error-codes`

**Verification:**
- ADR follows project template format
- Patterns documented with rationale
- Examples from actual codebase included

**Done when:**
- ADR created documenting API response standards
- Team can reference for consistency

---

## Task 3: Log Inconsistencies for Future

**Objective:** Create a tracking document of API inconsistencies to address in future phases.

**Actions:**
1. Based on Task 1 audit, identify endpoints that deviate from standard patterns
2. Create `.planning/phases/20-api-standardization/INCONSISTENCIES.md` listing:
   - Endpoint
   - Current pattern
   - Expected pattern
   - Priority (low/medium - none should be critical)
3. Note: Do NOT fix these now - just document for future consideration
4. Update `.planning/ISSUES.md` if any inconsistencies warrant tracking there

**Verification:**
- Inconsistencies documented with specific endpoints
- Prioritized by impact

**Done when:**
- Inconsistency tracking document created
- Any high-priority items noted in ISSUES.md

</tasks>

<verification>
## Plan Verification

After completing all tasks:

1. **Response Audit Complete:**
   - Controllers sampled across modules
   - Response patterns documented with counts
   - Variance understood

2. **Documentation Created:**
   - ADR-0006 documents API response standards
   - Inconsistencies logged for future
   - Team can reference for consistency

3. **No Breaking Changes:**
   - This plan is audit/documentation only
   - No API changes should be made
</verification>

<success_criteria>
- [ ] Response pattern audit completed with findings documented
- [ ] ADR created documenting API response standards
- [ ] Inconsistencies logged (not fixed) for future consideration
- [ ] No code changes made (documentation only)
</success_criteria>

<output>
After execution:
1. Create `20-01-SUMMARY.md` with findings
2. Update `STATE.md` with any decisions made
3. Update `ROADMAP.md` with phase completion
4. Commit changes
</output>
