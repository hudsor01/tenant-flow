---
phase: 13-frontend-checkout-subscriptions
plan: 01
type: execute
domain: stripe-frontend
---

<objective>
Build subscription plan selection UI with pricing cards and upgrade/downgrade flows.

Purpose: Allow property owners to view available subscription plans and upgrade/downgrade their subscription.
Output: Pricing page with plan cards, upgrade confirmation dialog, integrated with existing backend endpoints.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-frontend-checkout-subscriptions/RESEARCH.md
@.planning/phases/13-frontend-checkout-subscriptions/13-CONTEXT.md

**Prior summaries:**
@.planning/phases/12-webhook-security-reliability/12-03-SUMMARY.md

**Key source files:**
@apps/frontend/src/lib/stripe/stripe-client.ts
@apps/frontend/src/components/payments/rent-collection/subscriptions-tab.tsx

**Tech stack available:**
- @stripe/react-stripe-js (installed)
- @stripe/stripe-js (installed)
- createCheckoutSession() exists in stripe-client.ts

**Backend endpoints (already exist):**
- POST /api/v1/stripe/create-checkout-session
- GET /api/v1/stripe/subscriptions
- POST /api/v1/stripe/create-billing-portal

**Constraining decisions:**
- Use existing createCheckoutSession() from stripe-client.ts
- Leverage Customer Portal for complex subscription changes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create subscription pricing page with plan cards</name>
  <files>
    apps/frontend/src/app/(owner)/billing/plans/page.tsx,
    apps/frontend/src/components/billing/plan-card.tsx
  </files>
  <action>
    Create a Server Component page at /billing/plans that displays available subscription plans.

    **Page (page.tsx):**
    - Fetch available plans from backend (or define static plans initially)
    - Display current subscription status if user has one
    - Render PlanCard for each plan
    - Include "Manage Subscription" button linking to Customer Portal

    **PlanCard component:**
    - Props: name, price, features[], isCurrentPlan, isMostPopular
    - Display price with /mo suffix
    - List features with checkmarks
    - "Current Plan" badge if active
    - "Most Popular" badge if applicable
    - CTA button: "Get Started" for new, "Upgrade" for lower tier, "Downgrade" for higher tier
    - Use Card from shadcn/ui
    - Touch targets min-h-11 per UI standards

    Follow existing component patterns from subscriptions-tab.tsx.
    Use Tailwind utilities (90%), design tokens (10%) per CLAUDE.md.
  </action>
  <verify>
    pnpm typecheck passes
    pnpm lint passes
    Page renders at localhost:3050/billing/plans without errors
  </verify>
  <done>
    Pricing page displays plan cards with correct styling
    Current plan is highlighted
    CTA buttons are visible and have correct labels
  </done>
</task>

<task type="auto">
  <name>Task 2: Add upgrade/downgrade confirmation dialog</name>
  <files>
    apps/frontend/src/components/billing/upgrade-dialog.tsx,
    apps/frontend/src/app/(owner)/billing/plans/page.tsx
  </files>
  <action>
    Create confirmation dialog for subscription changes.

    **UpgradeDialog component:**
    - Props: targetPlan, currentPlan, isOpen, onClose, onConfirm
    - Display: "Upgrade to {plan}" or "Downgrade to {plan}"
    - Show price difference (prorated)
    - Show what changes (features gained/lost)
    - Confirm/Cancel buttons
    - Use Dialog from shadcn/ui
    - Loading state during confirmation

    **Integration:**
    - Wire PlanCard CTA to open dialog
    - On confirm: Call createCheckoutSession() for new subscriptions
    - For existing subscriptions: Redirect to Customer Portal (use createCustomerPortalSession)

    Handle errors with toast notifications.
    Use existing createCheckoutSession from stripe-client.ts.
  </action>
  <verify>
    Dialog opens when clicking upgrade/downgrade button
    Confirmation triggers correct flow (checkout or portal)
    Error states show toast messages
  </verify>
  <done>
    Upgrade dialog appears on CTA click
    Correct flow for new vs existing subscriptions
    Loading and error states work
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Subscription plan selection UI with upgrade/downgrade flows</what-built>
  <how-to-verify>
    1. Run: pnpm --filter @repo/frontend dev
    2. Visit: http://localhost:3050/billing/plans
    3. Verify: Plan cards display with features and pricing
    4. Click: "Upgrade" or "Get Started" button
    5. Verify: Confirmation dialog appears with plan details
    6. Confirm: Dialog has correct styling and information
    7. Test: Cancel closes dialog, Confirm triggers checkout or portal redirect
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] pnpm typecheck passes
- [ ] pnpm lint passes
- [ ] No console errors on pricing page
- [ ] Plan cards render correctly
- [ ] Dialog opens and closes properly
- [ ] Checkout/Portal redirect works
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Pricing page accessible at /billing/plans
- Upgrade/downgrade flow functional
</success_criteria>

<output>
After completion, create `.planning/phases/13-frontend-checkout-subscriptions/13-01-SUMMARY.md`
</output>
